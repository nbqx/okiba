/**
 * timbre 0.1.0 / JavaScript Library for Objective Sound Programming
 */var timbre=function(a,b){"use strict";var b=function(){return b.fn.init.apply(b,arguments)};b.VERSION="0.1.0",b.BUILD="Sat, 02 Jun 2012 11:27:38 GMT",b.env="",b.platform="",b.samplerate=44100,b.channels=2,b.cellsize=128,b.streamsize=1024,b.dacs=[],b.timers=[],b.listeners=[],b.sys=null,b.context={},b._={ev:{},amp:.8,autorun:!0,verbose:!0,workerpath:"",none:new Float32Array(b.cellsize)};var c=function(){},d=function(){var a=function(){d.apply(this,arguments)},c=a.prototype,d=function(a,c){a=a||b.streamsize,c=c||b.channels,c=c===1?1:2,this.streamsize=a,this.channels=c,this.L=new Float32Array(a),this.R=new Float32Array(a),this.cell=new Float32Array(b.cellsize),this.seq_id=0,this._={},this._.impl=null,this._.ison=!1,this._.cellsize=b.cellsize};c.bind=function(a){this._.impl=new a(this)},c.on=function(){this._.impl&&(this._.ison=!0,this._.impl.on())},c.off=function(){this._.impl&&(this._.impl.off(),this._.ison=!1)},c.process=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;a=this.cell,c=this.L,d=this.R,w=b._.amp,e=this.seq_id,m=c.length,q=this._.cellsize,s=this.streamsize/q,t=0;for(l=m;l--;)c[l]=d[l]=0;for(r=s;r--;){++e,h=b.timers.slice(0);for(n=0,o=h.length;n<o;++n)(i=h[n])!==undefined&&i.seq(e);f=b.dacs.slice(0);for(n=0,o=f.length;n<o;++n)if((g=f[n])!==undefined){g.seq(e),u=g.L,v=g.R;for(p=0,l=t;p<q;++p,++l)c[l]+=u[p],d[l]+=v[p]}t=l,j=b.listeners.slice(0);for(n=0,o=j.length;n<o;++n)(k=j[n])!==undefined&&k.seq(e)}for(l=m=c.length;l--;)x=c[l]*w,x<-1?x=-1:1<x&&(x=1),c[l]=x,x=d[l]*w,x<-1?x=-1:1<x&&(x=1),d[l]=x;for(p=q;p--;)a[p]=c[p]+d[p],x=a[p]*w*.5,x<-1?x=-1:1<x&&(x=1),a[p]=x;this.seq_id=e};return a}();b.sys=new d,Object.defineProperty(b,"amp",{set:function(a){typeof a=="number"&&(b._.amp=a)},get:function(){return b._.amp}}),Object.defineProperty(b,"autorun",{set:function(a){b._.autorun=!!a},get:function(){return b._.autorun}}),Object.defineProperty(b,"workerpath",{set:function(a){typeof a=="string"&&(b._.workerpath=a)},get:function(){return b._.workerpath}}),Object.defineProperty(b,"verbose",{set:function(a){b._.verbose=!!a},get:function(){return b._.verbose}}),Object.defineProperty(b,"isOn",{get:function(){return b.sys._.ison}}),Object.defineProperty(b,"isOff",{get:function(){return!b.sys._.ison}}),b.on=function(){b.sys._.ison||(b.sys.on(),b.fn.do_event(this,"on"));return b},b.off=function(){b.sys._.ison&&(b.sys.off(),b.fn.do_event(this,"off"));return b},b.addEventListener=function(a,b){var c,d,e;typeof b=="function"&&(a[0]==="~"&&(a=a.substr(1),b.rm=!0),c=this._.ev[a],c===undefined&&(this._.ev[a]=c=[]),(e=c.indexOf(b))===-1&&c.push(b));return this},b.removeEventListener=function(a,b){var c,d;typeof a=="string"&&a!==""&&(c=this._.ev[a],c!==undefined&&(d=c.indexOf(b))!==-1&&c.splice(d,1));return this},b.removeAllEventListeners=function(a){typeof a=="string"&&a!==""&&(delete this._.ev[a],delete this["on"+a]);return this},function(){var a=function(){var a,c,d,e,f;a=b.fn.valist(arguments);for(e=0,f=a.length,d=!1;e<f;++e)c=Object.getPrototypeOf(a[e]),c._.type===this.type&&this.indexOf(a[e])===-1&&(this.push(a[e]),d=!0);d&&b._.autorun&&this!==b.listeners&&b.on();return this},c=function(){var a,c;for(a=arguments.length;a--;)(c=this.indexOf(arguments[a]))!==-1&&this.splice(c,1);b._.autorun&&b.dacs.length===0&&b.timers.length===0&&b.off();return this},d=function(){while(this.length>0)this.pop();b._.autorun&&b.dacs.length===0&&b.timers.length===0&&b.off();return this},e,f;for(e=arguments.length;e--;)f=arguments[e],f.append=a,f.remove=c,f.removeAll=d}(b.dacs,b.timers,b.listeners),b.dacs.type=1,b.timers.type=2,b.listeners.type=3,b.fn=function(a){var b={},d={};d.find=function(b){if(typeof d[b]=="function")return d[b];b="-"+a.env+"-"+b;if(typeof d[b]=="function")return d[b]};var i={optional:{},properties:{}};i.optional.ar=function(){this._.ar=!0;return this},i.optional.kr=function(){this._.ar=!1;return this},i.optional.fixrate=function(){return this},i.optional.listen=function(c){c===null?(this.args=this._.args,a.listeners.remove(this)):b.isTimbreObject(c)&&(this._.args=this.args,this.args.removeAll(),this.args.append(c),a.listeners.append(this));return this},i.optional.dac={},i.optional.dac.on=function(){this._.ison=!0,a.dacs.append(this),a.fn.do_event(this,"on");var b=Object.getPrototypeOf(this);b._.on&&b._.on.call(this);return this},i.optional.dac.off=function(){this._.ison=!1,a.dacs.remove(this),a.fn.do_event(this,"off");var b=Object.getPrototypeOf(this);b._.off&&b._.off.call(this);return this},i.optional.dac.play=function(){this._.ison=!0,a.dacs.append(this),a.fn.do_event(this,"play");var b=Object.getPrototypeOf(this);b._.play&&b._.play.call(this);return this},i.optional.dac.pause=function(){this._.ison=!1,a.dacs.remove(this),a.fn.do_event(this,"pause");var b=Object.getPrototypeOf(this);b._.pause&&b._.pause.call(this);return this},i.optional.timer={},i.optional.timer.on=function(){this._.ison=!0,a.timers.append(this),a.fn.do_event(this,"on");var b=Object.getPrototypeOf(this);b._.on&&b._.on.call(this);return this},i.optional.timer.off=function(){this._.ison=!1,a.timers.remove(this),a.fn.do_event(this,"off");var b=Object.getPrototypeOf(this);b._.off&&b._.off.call(this);return this},i.optional.timer.play=function(){a.fn.do_event(this,"play");return this},i.optional.timer.pause=function(){a.fn.do_event(this,"pause");return this},b.init=function(){var c,i,j,k,l,m;c=Array.prototype.slice.call(arguments),i=c[0];switch(typeof i){case"string":j=d.find(i),j&&(k=new j(c.slice(1)));break;case"number":k=new e([i]);break;case"boolean":k=new f([i]);break;case"function":k=new h(c);break;case"object":i===null?k=new e([0]):b.isTimbreObject(i)&&(k=i,l=!0),k===undefined&&(i instanceof Array||i.buffer instanceof ArrayBuffer)&&(k=new g([i]))}k===undefined&&(k=new e([0])),m=Object.getPrototypeOf(k),l||(k.seq_id=-1,k.cell||(k.cell=new Float32Array(a.cellsize)),k.args||(k.args=[]),a.fn.arrayset(k.args),k.hasOwnProperty("_")||(k._={}),typeof !k._.ev!="object"&&(k._.ev={}),typeof k._.ar!="boolean"&&(m&&typeof m._=="object"?k._.ar=!!m._.ar:k._.ar=!1),typeof k._.ison!="boolean"&&(k._.ison=!0),typeof k._.mul!="number"&&(k._.mul=1),typeof k._.add!="number"&&(k._.add=0),typeof k._.dac!="object"&&(k._.dac=null)),m._.init&&m._.init.call(k);return k},i.play=function(){var b=this._;b.ar&&(b.dac===null?(b.dac=a("dac",this),a.fn.do_event(this,"play")):this.dac.args.indexOf(this)===-1&&(b.dac.append(this),a.fn.do_event(this,"play")),b.dac.isOff&&b.dac.on());return this},i.pause=function(){var b=this._;b.dac&&b.dac.args.indexOf(this)!==-1&&(b.dac.remove(this),a.fn.do_event(this,"pause"),b.dac.isOn&&b.dac.args.length===0&&b.dac.off());return this},i.bang=function(){a.fn.do_event(this,"bang");return this},i.seq=function(){return this.cell},i.on=function(){this._.ison=!0,a.fn.do_event(this,"on");return this},i.off=function(){this._.ison=!1,a.fn.do_event(this,"off");return this},i.clone=function(b){var c=a(Object.getPrototypeOf(this)._.klassname);a.fn.copy_for_clone(this,c,b);return c},i.append=function(){this.args.append.apply(this.args,arguments);return this},i.remove=function(){this.args.remove.apply(this.args,arguments);return this},i.removeAll=function(){this.args.removeAll.apply(this.args,arguments);return this},i.set=function(a,b){var c;c=this;while(c!==null){if(Object.getOwnPropertyDescriptor(c,a)){this[a]=b;break}c=Object.getPrototypeOf(c)}return this},i.get=function(a){var b,c;b=this;while(b!==null){if(Object.getOwnPropertyDescriptor(b,a)){c=this[a];break}b=Object.getPrototypeOf(b)}return c},i.addEventListener=a.addEventListener,i.removeEventListener=a.removeEventListener,i.removeAllEventListeners=a.removeAllEventListeners,i.properties.isAr={get:function(){return!!this._.ar}},i.properties.isKr={get:function(){return!this._.ar}},i.properties.isOn={get:function(){return!!this._.ison}},i.properties.isOff={get:function(){return!this._.ison}},i.properties.dac={set:function(a){a!==this._.dac&&(this._.dac&&this._.dac.remove(this),a!==null?this._.dac=a.append(this):this._.dac=null)},get:function(){return this._.dac}},i.properties.mul={set:function(a){typeof a=="number"&&(this._.mul=a)},get:function(){return this._.mul}},i.properties.add={set:function(a){typeof a=="number"&&(this._.add=a)},get:function(){return this._.add}},b.register=function(a,e,f){var g,h,j,k;if(typeof e=="function"){h=e.prototype,j=new c;if(typeof h._=="object")for(k in h._)j[k]=h._[k];h._=j;for(g in i)typeof i[g]=="function"&&(h[g]||(h[g]=i[g]));for(g in i.properties)Object.getOwnPropertyDescriptor(h,g)||Object.defineProperty(h,g,i.properties[g]);typeof h.ar!="function"&&b.setPrototypeOf.call(h,"ar-kr"),typeof a=="string"&&(f?d[a]=f:(h._.klassname=a,h._.klass=e,d[a]=e))}},b.setPrototypeOf=function(a){this._||(this._={});switch(a){case"ar-only":this.ar=i.optional.fixrate,this.kr=i.optional.fixrate,this._.ar=!0;break;case"kr-only":this.ar=i.optional.fixrate,this.kr=i.optional.fixrate,this._.ar=!1;break;case"kr-ar":this.ar=i.optional.ar,this.kr=i.optional.kr,this._.ar=!1;break;case"ar-kr":this.ar=i.optional.ar,this.kr=i.optional.kr,this._.ar=!0;break;case"dac":this.on=i.optional.dac.on,this.off=i.optional.dac.off,this.play=i.optional.dac.play,this.pause=i.optional.dac.pause,this._.type=1;break;case"timer":this.on=i.optional.timer.on,this.off=i.optional.timer.off,this.play=i.optional.timer.play,this.pause=i.optional.timer.pause,this._.type=2;break;case"listener":this.listen=i.optional.listen,this._.type=3}},b.valist=function(b){var c,d,e;c=[];for(d=0,e=b.length;d<e;++d)switch(typeof b[d]){case"number":case"boolean":case"function":case"undefined":c.push(a(b[d]));break;case"object":b[d]===null?c.push(a(null)):c.push(b[d]);break;default:c.push(a(undefined))}return c},b.arrayset=function(){var a=function(){var a,c,d;a=b.valist(arguments);for(c=0,d=a.length;c<d;++c)this.indexOf(a[c])===-1&&this.push(a[c]);return this},c=function(){var a,b;for(a=arguments.length;a--;)(b=this.indexOf(arguments[a]))!==-1&&this.splice(b,1);return this},d=function(){while(this.length>0)this.pop();return this},e=function(){this.append.apply(this,list);return this};return function(b){var f,g,h,i=[];for(f=1,g=b.length;f<g;++f)h=b.indexOf(b[f]),h!==-1&&h<f&&i.push(f);while(i.length)b.splice(i.pop(),1);b.append=a,b.remove=c,b.removeAll=d,b.extend=e;return b}}(),b.do_event=function(a,b,c){var d,e,f,g;d=a["on"+b],typeof d=="function"&&d.apply(a,c),e=a._.ev[b];if(e!==undefined)for(f=0,g=e.length;f<g;++f)d=e[f],d.apply(a,c),d.rm&&a.removeEventListener(b,d)},b.copy_for_clone=function(a,b,c){var d,e,f;b._.ar=a._.ar,b._.mul=a._.mul,b._.add=a._.add,b._.ison=a._.ison,d=a.args;if(c)for(e=0,f=d.length;e<f;++e)b.args[e]=d[e].clone(!0);else for(e=0,f=d.length;e<f;++e)b.args[e]=d[e];return b},b.isTimbreObject=function(a){return typeof a=="object"&&Object.getPrototypeOf(a)._ instanceof c};return b}(b);var e=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only"),Object.defineProperty(c,"value",{set:function(a){typeof a=="number"&&(this._.value=a,e.call(this))},get:function(){return this._.value}}),Object.defineProperty(c,"mul",{set:function(a){typeof a=="number"&&(this._.mul=a,e.call(this))},get:function(){return this._.mul}}),Object.defineProperty(c,"add",{set:function(a){typeof a=="number"&&(this._.add=a,e.call(this))},get:function(){return this._.add}});var d=function(a){this._={},typeof a[0]=="number"?this._.value=a[0]:this._.value=0},e=function(){var a,b,c,d=this._;a=d.value*d.mul+d.add,b=this.cell;for(c=b.length;c--;)b[c]=a};c._.init=function(){this.value=this._.value},c.clone=function(){var a=b(this._.value);a._.mul=this._.mul,a._.add=this._.add,e.call(a);return a};return a}();b.fn.register("number",e);var f=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only"),Object.defineProperty(c,"value",{set:function(a){this._.value=!!a,e.call(this)},get:function(){return this._.value}}),Object.defineProperty(c,"mul",{set:function(a){typeof a=="number"&&(this._.mul=a,e.call(this))},get:function(){return this._.mul}}),Object.defineProperty(c,"add",{set:function(a){typeof a=="number"&&(this._.add=a,e.call(this))},get:function(){return this._.add}});var d=function(a){this._={},typeof a[0]=="boolean"?this._.value=a[0]:this._.value=!1},e=function(){var a,b,c,d=this._;a=(d.value?1:0)*d.mul+d.add,b=this.cell;for(c=b.length;c--;)b[c]=a};c._.init=function(){this.value=this._.value},c.clone=function(){var a=b(this._.value);a._.mul=this._.mul,a._.add=this._.add,e.call(a);return a},c.bang=function(){this._.value=!this._.value,e.call(this),b.fn.do_event(this,"bang");return this};return a}();b.fn.register("boolean",f);var g=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only"),Object.defineProperty(c,"value",{set:function(a){typeof a=="object"&&(a instanceof Array||a.buffer instanceof ArrayBuffer)&&(this._.value=a,this._.index=0)},get:function(){return this._.value}}),Object.defineProperty(c,"index",{set:function(a){var b=this._;typeof a=="number"&&(a=a|0,a<0&&(a=b.value.length+a),0<=a&&a<b.value.length&&(b.index=a,e.call(this)))},get:function(){return this._.index}}),Object.defineProperty(c,"mul",{set:function(a){typeof a=="number"&&(this._.mul=a,e.call(this))},get:function(){return this._.mul}}),Object.defineProperty(c,"add",{set:function(a){typeof a=="number"&&(this._.add=a,e.call(this))},get:function(){return this._.add}});var d=function(a){var b,c,d;this._=d={},c=0,typeof a[c]=="object"&&(a[c]instanceof Array||a[c].buffer instanceof ArrayBuffer)&&(b=a[c++]),d.value=b!==undefined?b:[],d.index=0},e=function(){var a,b,c,d=this._;a=d.value[d.index]*d.mul+d.add,b=this.cell;for(c=b.length;c--;)b[c]=a};c._.init=function(){this.index=0},c.clone=function(){var a=b(this._.value);a._.mul=this._.mul,a._.add=this._.add,e.call(a);return a},c.bang=function(){var a=this._;this.index=(a.index+1)%a.value.length,b.fn.do_event(this,"bang");return this},c.seq=function(a){var b=this._,c,d,e;c=this.cell;if(this.seq_id!==a){this.seq_id=a,d=b.value[b.index]*b.mul+b.add,isNaN(d)&&(d=0);for(e=c.length;e--;)c[e]=d}return c};return a}();b.fn.register("array",g);var h=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only"),Object.defineProperty(c,"value",{set:function(a){typeof a=="function"&&(this._.value=a)},get:function(){return this._.value}}),Object.defineProperty(c,"args",{set:function(a){typeof a=="object"&&a instanceof Array&&(this._.args=a)},get:function(){return this._.args}});var d=function(a){var b,c;this._=c={},b=0,typeof a[b]=="function"?c.value=a[b++]:c.value=null,typeof a[b]=="object"&&a[b]instanceof Array?c.args=a[b++]:c.args=[]};c.clone=function(a){return b("function",this._.value,this._.args)},c.bang=function(){var a=this._;a.value!==null&&a.value.apply(this,a.args),b.fn.do_event(this,"bang");return this};return a}();b.fn.register("function",h);var i=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),b.fn.setPrototypeOf.call(c,"dac"),Object.defineProperty(c,"dac",{get:function(){return this}}),Object.defineProperty(c,"pan",{set:function(a){this._.pan=b(a)},get:function(){return this._.pan}});var d=function(a){var c=this._={};this.args=b.fn.valist.call(this,a),this.pan=.5,this.L=new Float32Array(b.cellsize),this.R=new Float32Array(b.cellsize),c.prev_pan=undefined,c.ison=!1};c._.init=function(){var a,b;b=this.args;for(a=b.length;a--;)b[a].dac=this},c.clone=function(a){var c=b("dac");c._.pan=a?this._.pan.clone(!0):this._.pan,b.fn.copy_for_clone(this,c,a);return c},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l,m,n,o,p;e=this.cell;if(a!==this.seq_id){this.seq_id=a,i=c.pan.seq(a)[0],i!==c.prev_pan&&(c.panL=Math.cos(.5*Math.PI*i),c.panR=Math.sin(.5*Math.PI*i),c.prev_pan=i),f=this.L,g=this.R,h=c.mul,j=c.panL*h,k=c.panR*h,p=b.cellsize;for(o=p;o--;)e[o]=f[o]=g[o]=0;d=this.args.slice(0);for(m=0,n=d.length;m<n;++m)if(d[m]!==undefined){l=d[m].seq(a);for(o=p;o--;)e[o]+=l[o]*h,f[o]+=l[o]*j,g[o]+=l[o]*k}}return e};return a}();b.fn.register("dac",i),b.fn.register("pandac",i,function(a){var b=new i(a.slice(1));b.pan=a[0];return b});var j=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-kr");var d=function(a){this.args=b.fn.valist.call(this,a)};c.clone=function(a){var c;c=b("+"),b.fn.copy_for_clone(this,c,a);return c},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l;e=this.cell;if(a!==this.seq_id){this.seq_id=a,d=this.args.slice(0),f=c.mul,g=c.add,l=b.cellsize;if(c.ar){for(k=l;k--;)e[k]=0;for(i=0,j=d.length;i<j;++i){h=d[i].seq(a);for(k=l;k--;)e[k]+=h[k]}for(k=l;k--;)e[k]=e[k]*f+g}else{h=0;for(i=0,j=d.length;i<j;++i)h+=d[i].seq(a)[0];h=h*f+g;for(k=l;k--;)e[k]=h}}return e};return a}();b.fn.register("+",j);var k=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-kr");var d=function(a){this.args=b.fn.valist.call(this,a)};c.clone=function(a){var c;c=b("*"),b.fn.copy_for_clone(this,c,a);return c},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l;e=this.cell;if(a!==this.seq_id){this.seq_id=a,d=this.args.slice(0),f=c.mul,g=c.add,l=b.cellsize;if(c.ar){for(k=l;k--;)e[k]=f;for(i=0,j=d.length;i<j;++i){d[i].seq_id===a?h=d[i].cell:h=d[i].seq(a);for(k=l;k--;)e[k]*=h[k]}if(g!==0)for(k=l;k--;)e[k]+=g}else{h=f;for(i=0,j=d.length;i<j;++i)d[i].seq_id===a?h*=d[i].cell[0]:h*=d[i].seq(a)[0];h+=g;for(k=l;k--;)e[k]=h}}return e};return a}();b.fn.register("*",k);var l=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-kr"),Object.defineProperty(c,"wave",{set:function(b){var c,d,e;c=this._.wave;if(typeof b=="function")for(d=0;d<1024;d++)c[d]=b(d/1024);else if(typeof b=="object"&&(b instanceof Array||b.buffer instanceof ArrayBuffer))if(b.length===1024)this._.wave=b;else{e=b.length/1024;for(d=0;d<1024;d++)c[d]=b[d*e|0]||0}else typeof b=="string"&&(e=a.Wavetables[b])!==undefined&&(typeof e=="function"&&(e=e()),this._.wave=e)},get:function(){return this._.wave}}),Object.defineProperty(c,"freq",{set:function(a){this._.freq=b(a)},get:function(){return this._.freq}}),Object.defineProperty(c,"phase",{set:function(a){if(typeof a=="number"){while(a>=1)a-=1;while(a<0)a+=1;this._.phase=a,this._.x=1024*this._.phase}},get:function(){return this._.phase}});var d=function(c){var d,e;this._=e={},d=0,e.wave=new Float32Array(1024),typeof c[d]=="function"?this.wave=c[d++]:typeof c[d]=="object"&&c[d]instanceof Float32Array?this.wave=c[d++]:typeof c[d]=="string"&&a.Wavetables[c[d]]?this.wave=c[d++]:this.wave="sin",typeof c[d]!="undefined"?this.freq=c[d++]:this.freq=440,typeof c[d]=="number"&&(e.mul=c[d++]),typeof c[d]=="number"&&(e.add=c[d++]),e.phase=0,e.x=1024*e.phase,e.coeff=1024/b.samplerate};c.clone=function(a){var c,d=this._;c=b("osc",d.wave),a?c._.freq=d.freq.clone(!0):c._.freq=d.freq,c._.phase=d.phase,b.fn.copy_for_clone(this,c,a);return c},c.bang=function(){this._.x=1024*this._.phase,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a,e=c.freq.seq(a),f=c.mul,g=c.add,h=c.wave,i=c.x,k=c.coeff;if(c.ar)if(c.freq.isAr)for(q=0,r=b.cellsize;q<r;++q)l=i|0,m=i-l,n=h[l&1023],o=h[l+1&1023],p=(1-m)*n+m*o,d[q]=p*f+g,i+=e[q]*k;else{j=e[0]*k;for(q=0,r=b.cellsize;q<r;++q)l=i|0,m=i-l,n=h[l&1023],o=h[l+1&1023],p=(1-m)*n+m*o,d[q]=p*f+g,i+=j}else{l=i|0,m=i-l,n=h[l&1023],o=h[l+1&1023],p=(1-m)*n+m*o,p=p*f+g;for(q=0,r=b.cellsize;q<r;++q)d[q]=p;i+=e[0]*k*r}c.x=i}return d},c.getWavetable=function(b){var c=a.Wavetables[b];if(c!==undefined){typeof c=="function"&&(c=c());return c}},c.setWavetable=function(b,c){var d,e;if(typeof c=="function"){d=new Float32Array(1024);for(e=0;e<1024;e++)d[e]=c(e/1024);a.Wavetables[b]=d}else if(typeof c=="object"&&(c instanceof Array||c.buffer instanceof ArrayBuffer))if(c.length===1024)a.Wavetables[b]=c;else{d=new Float32Array(1024),dx=c.length/1024;for(e=0;e<1024;e++)d[e]=c[e*dx|0]||0;a.Wavetables[b]=c}};return a}();b.fn.register("osc",l),l.Wavetables={},l.Wavetables.sin=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=Math.sin(2*Math.PI*(b/1024));return a},l.Wavetables["+sin"]=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=Math.sin(2*Math.PI*(b/1024))*.5+.5;return a},l.Wavetables.cos=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=Math.cos(2*Math.PI*(b/1024));return a},l.Wavetables["+cos"]=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=Math.cos(2*Math.PI*(b/1024))*.5+.5;return a},l.Wavetables.pulse=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=b<512?-1:1;return a},l.Wavetables["+pulse"]=function(){var a,b;a=new Float32Array(1024);for(b=0;b<1024;++b)a[b]=b<512?0:1;return a},l.Wavetables.tri=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024-.25,a[c]=1-4*Math.abs(Math.round(b)-b);return a},l.Wavetables["+tri"]=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024-.25,a[c]=(1-4*Math.abs(Math.round(b)-b))*.5+.5;return a},l.Wavetables.sawup=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024,a[c]=2*(b-Math.round(b));return a},l.Wavetables["+sawup"]=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024,a[c]=2*(b-Math.round(b))*.5+.5;return a},l.Wavetables.saw=l.Wavetables.sawup,l.Wavetables["+saw"]=l.Wavetables["+sawup"],l.Wavetables.sawdown=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024,a[c]=-2*(b-Math.round(b));return a},l.Wavetables["+sawdown"]=function(){var a,b,c;a=new Float32Array(1024);for(c=0;c<1024;++c)b=c/1024,a[c]=-2*(b-Math.round(b))*.5+.5;return a},l.Wavetables.fami=function(){var a,b,c,d,e;b=[0,.125,.25,.375,.5,.625,.75,.875,.875,.75,.625,.5,.375,.25,.125,0,-0.125,-0.25,-0.375,-0.5,-0.625,-0.75,-0.875,-1,-1,-0.875,-0.75,-0.625,-0.5,-0.375,-0.25,-0.125],a=new Float32Array(1024);for(d=0;d<1024;++d)a[d]=b[d/1024*b.length|0];return a},l.Wavetables.konami=function(){var a,b,c,d,e;b=[-0.625,-0.875,-0.125,.75,.5,.125,.5,.75,.25,-0.125,.5,.875,.625,0,.25,.375,-0.125,-0.75,0,.625,.125,-0.5,-0.375,-0.125,-0.75,-1,-0.625,0,-0.375,-0.875,-0.625,-0.25],a=new Float32Array(1024);for(d=0;d<1024;++d)a[d]=b[d/1024*b.length|0];return a},b.fn.register("sin",l,function(a){return new l(["sin"].concat(a))}),b.fn.register("cos",l,function(a){return new l(["cos"].concat(a))}),b.fn.register("pulse",l,function(a){return new l(["pulse"].concat(a))}),b.fn.register("tri",l,function(a){return new l(["tri"].concat(a))}),b.fn.register("saw",l,function(a){return new l(["saw"].concat(a))}),b.fn.register("fami",l,function(a){return new l(["fami"].concat(a))}),b.fn.register("konami",l,function(a){return new l(["konami"].concat(a))}),b.fn.register("+sin",l,function(a){return(new l(["+sin"].concat(a))).kr()}),b.fn.register("+cos",l,function(a){return(new l(["+cos"].concat(a))).kr()}),b.fn.register("+pulse",l,function(a){return(new l(["+pulse"].concat(a))).kr()}),b.fn.register("+tri",l,function(a){return(new l(["+tri"].concat(a))).kr()}),b.fn.register("+saw",l,function(a){return(new l(["+saw"].concat(a))).kr()});var m=function(){var a=function(){e.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-kr"),Object.defineProperty(c,"func",{set:function(a){typeof a=="function"&&(this._.func=a)},get:function(){return this._.func}}),Object.defineProperty(c,"numOfSamples",{set:function(a){typeof a=="number"&&(this._.saved=new Float32Array(a),this._.numOfSamples=a)},get:function(){return this._.numOfSamples}}),Object.defineProperty(c,"freq",{set:function(a){this._.freq=b(a)},get:function(){return this._.freq}}),Object.defineProperty(c,"phase",{set:function(a){if(typeof a=="number"){while(a>=1)a-=1;while(a<0)a+=1;this._.phase=this._.x=a}},get:function(){return this._.phase}});var d=function(a){return a},e=function(a){var c,e,f;this._=f={},e=0,typeof a[e]=="number"&&a[e]>0?f.numOfSamples=a[e++]|0:f.numOfSamples=0,typeof a[e]=="function"?f.func=a[e++]:f.func=d,typeof a[e]!="undefined"?this.freq=a[e++]:this.freq=440,f.saved=new Float32Array(f.numOfSamples),f.index=0,f.phase=f.x=0,f.coeff=1/b.samplerate};c.clone=function(a){var c,d=this._;c=b("func",d.func,null,d.numOfSamples),a?c._.freq=d.freq.clone(!0):c._.freq=d.freq,c._.phase=d.phase,b.fn.copy_for_clone(this,c,a);return c},c.bang=function(){this._.x=this._.phase,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(!c.ison)return b._.none;d=this.cell;if(this.seq_id!==a){this.seq_id=a,e=c.func,f=c.freq.seq(a),g=c.x,h=c.coeff,i=c.mul,j=c.add,k=c.saved,p=c.index,q=k.length;for(n=0,o=d.length;n<o;++n,++p){if(q===0)d[n]=e(g)*i+j;else{if(p>=q){m=e(g,f[n]*h);if(q!==0)for(r=m.length;r--;)k[r]=m[r]||0;p=0}d[n]=k[p]*i+j}g+=f[n]*h;while(g>=1)g-=1}c.index=p,c.x=g}return d};return a}();b.fn.register("func",m);var n=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-kr");var d=function(a){};c.clone=function(a){var c,d=this._;c=b("noise"),b.fn.copy_for_clone(this,c,a);return c},c.seq=function(a){var c=this._,d,e,f,g,h;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a,e=c.mul,f=c.add;if(c.ar)for(h=d.length;h--;)d[h]=(Math.random()*2-1)*e+f;else{g=(Math.random()*2-1)*e+f;for(h=d.length;h--;)d[h]=g}}return d};return a}();b.fn.register("noise",n);var o=function(){var a=function(){e.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only");var d=["off","delay","a","d","s","r"];Object.defineProperty(c,"status",{get:function(){return d[this._.status+1]}}),Object.defineProperty(c,"delay",{set:function(a){typeof a=="number"&&(this._.delay=a)},get:function(){return this._.delay}}),Object.defineProperty(c,"a",{set:function(a){typeof a=="number"&&(this._.a=a)},get:function(){return this._.a}}),Object.defineProperty(c,"d",{set:function(a){typeof a=="number"&&(this._.d=a)},get:function(){return this._.d}}),Object.defineProperty(c,"s",{set:function(a){typeof a=="number"&&(this._.s=a)},get:function(){return this._.s}}),Object.defineProperty(c,"r",{set:function(a){typeof a=="number"&&(this._.r=a)},get:function(){return this._.r}}),Object.defineProperty(c,"al",{set:function(a){typeof a=="number"&&(this._.al=a)},get:function(){return this._.al}}),Object.defineProperty(c,"dl",{set:function(a){typeof a=="number"&&(this._.dl=a)},get:function(){return this._.dl}}),Object.defineProperty(c,"sl",{set:function(a){typeof a=="number"&&(this._.sl=a)},get:function(){return this._.sl}}),Object.defineProperty(c,"rl",{set:function(a){typeof a=="number"&&(this._.rl=a)},get:function(){return this._.rl}}),Object.defineProperty(c,"reversed",{set:function(a){typeof a=="boolean"&&(this._.reversed=a)},get:function(){return this._.reversed}}),Object.defineProperty(c,"currentTime",{get:function(){return this._.currentTime}});var e=function(a){var b,c;c=this._={},b=0,c.a=typeof a[b]=="number"?a[b++]:0,c.d=typeof a[b]=="number"?a[b++]:0,c.sl=typeof a[b]=="number"?a[b++]:0,c.r=typeof a[b]=="number"?a[b++]:0,c.delay=0,c.al=0,c.dl=1,c.rl=0,c.s=Infinity,c.reversed=!1,c.status=-1,c.samples=Infinity,c.x0=0,c.x1=0,c.dx=0,c.currentTime=0};c.clone=function(a){var c,d=this._,e,f,g;c=b("adsr",d.a,d.d,d.sl,d.r),c._.delay=d.delay,c._.s=d.s,c._.reversed=d.reversed,b.fn.copy_for_clone(this,c,a);return c},c.bang=function(a){var c=this._;c.status=0,c.samples=b.samplerate*(c.delay/1e3)|0,c.x0=0,c.x1=1,c.dx=b.cellsize*c.al/c.samples,c.currentTime=0,b.fn.do_event(this,"bang");return this},c.keyoff=function(){var a=this._;a.status<=3&&(a.status=4,a.samples=b.samplerate*(a.r/1e3)|0,a.x1=a.x0,a.x0=1,a.dx=-b.cellsize*(1-a.rl)/a.samples,b.fn.do_event(this,"R"))},c.seq=function(a){var c=this._,d,e,f,g;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a;while(c.samples<=0){if(c.status===0){c.status=1,c.samples+=b.samplerate*(c.a/1e3)|0,c.x0=c.al,c.dx=b.cellsize*(c.dl-c.al)/c.samples,b.fn.do_event(this,"A");continue}if(c.status===1){c.status=2,c.samples+=b.samplerate*(c.d/1e3)|0,c.x0=c.dl,c.dx=-b.cellsize*(c.dl-c.sl)/c.samples,b.fn.do_event(this,"D");continue}if(c.status===2){if(c.sl===0){c.status=4;continue}c.status=3,c.x0=c.sl,c.s===Infinity?(c.samples=Infinity,c.dx=0):(c.samples+=b.samplerate*(c.s/1e3)|0,c.dx=-b.cellsize*(c.sl-c.rl)/c.samples),b.fn.do_event(this,"S");continue}if(c.status<=4){c.status=-1,c.samples=Infinity,c.x0=c.x1=c.dx=0,b.fn.do_event(this,"ended");continue}}c.reversed?e=(1-c.x0*c.x1)*c.mul+c.add:e=c.x0*c.x1*c.mul+c.add;for(f=0,g=d.length;f<g;++f)d[f]=e;c.x0+=c.dx,c.samples-=g,c.currentTime+=g*1e3/b.samplerate}return d};return a}();b.fn.register("adsr",o);var p=function(){var a=function(){e.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only");var d=["off","delay","a","r"];Object.defineProperty(c,"status",{get:function(){return d[this._.status+1]}}),Object.defineProperty(c,"delay",{set:function(a){typeof a=="number"&&(this._.delay=a)},get:function(){return this._.delay}}),Object.defineProperty(c,"a",{set:function(a){typeof a=="number"&&(this._.a=a)},get:function(){return this._.a}}),Object.defineProperty(c,"r",{set:function(a){typeof a=="number"&&(this._.r=a)},get:function(){return this._.r}}),Object.defineProperty(c,"al",{set:function(a){typeof a=="number"&&(this._.al=a)},get:function(){return this._.al}}),Object.defineProperty(c,"reversed",{set:function(a){typeof a=="boolean"&&(this._.reversed=a)},get:function(){return this._.reversed}}),Object.defineProperty(c,"currentTime",{get:function(){return this._.currentTime}});var e=function(a){var b,c;this._=c={},b=0,c.r=typeof a[b]=="number"?a[b++]:0,typeof a[b]=="function"&&(this.onended=a[b++]),c.delay=0,c.a=0,c.al=0,c.reversed=!1,c.status=-1,c.samples=Infinity,c.x0=0,c.dx=0,c.currentTime=0};c.clone=function(a){var c=this._,d=b("perc",c.r);d._.delay=c.delay,d._.a=c.a,d._.al=c.al,d._.reversed=c.reversed,b.fn.copy_for_clone(this,d,a);return d},c.bang=function(){var a=this._;a.status=0,a.samples=b.samplerate*(a.delay/1e3)|0,a.x0=0,a.dx=-(b.cellsize*a.al)/a.samples,a.currentTime=0,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f,g;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a;while(c.samples<=0){if(c.status===0){c.status=1,c.samples+=b.samplerate*(c.a/1e3)|0,c.x0=c.al,c.dx=-(b.cellsize*(1-c.al))/c.samples,b.fn.do_event(this,"A");continue}if(c.status===1){c.status=2,c.samples=b.samplerate*(c.r/1e3)|0,c.x0=1,c.dx=b.cellsize/c.samples,b.fn.do_event(this,"R");continue}if(c.status===2){c.status=-1,c.samples=Infinity,c.x0=c.dx=0,b.fn.do_event(this,"ended");continue}}c.reversed?e=(1-c.x0)*c.mul+c.add:e=c.x0*c.mul+c.add;for(f=0,g=d.length;f<g;++f)d[f]=e;c.x0-=c.dx,c.samples-=g,c.currentTime+=g*1e3/b.samplerate}return d};return a}();b.fn.register("perc",p);var q=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"type",{set:function(b){var c;typeof b=="string"&&(c=a.Types[b])!==undefined&&(this._.type=b,this._.set_params=c.set_params)},get:function(){return this._.type}}),Object.defineProperty(c,"freq",{set:function(a){this._.freq=b(a)},get:function(){return this._.freq}}),Object.defineProperty(c,"band",{set:function(a){this._.band=b(a)},get:function(){return this._.band}}),Object.defineProperty(c,"gain",{set:function(a){this._.gain=b(a)},get:function(){return this._.gain}});var d=function(c){var d,e,f;this._=f={},e=0,typeof c[e]=="string"&&a.Types[c[e]]!==undefined?this.type=c[e++]:this.type="lpf",d=this._.type,typeof c[e]=="object"&&c[e].isKr?f.freq=c[e++]:typeof c[e]=="number"?f.freq=b(c[e++]):f.freq=b(a.Types[d].default_freq),typeof c[e]=="object"&&c[e].isKr?f.band=c[e++]:typeof c[e]=="number"?f.band=b(c[e++]):f.band=b(a.Types[d].default_band),typeof c[e]=="object"&&c[e].isKr?f.gain=c[e++]:typeof c[e]=="number"?f.gain=b(c[e++]):f.gain=b(a.Types[d].default_gain||6),this.args=b.fn.valist.call(this,c.slice(e)),f.prev_type=undefined,f.prev_freq=undefined,f.prev_band=undefined,f.prev_gain=undefined,f.in1=f.in2=f.out1=f.out2=0};c.clone=function(a){var c,d=this._,e,f,g;c=b("filter",d.type),a?(c.freq=d.freq.clone(a),c.band=d.band.clone(a),c.gain=d.gain.clone(a)):(c.freq=d.freq,c.band=d.band,c.gain=d.gain),b.fn.copy_for_clone(this,c,a);return c},c.seq=function(a){var b=this._,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;d=this.cell;if(a!==this.seq_id){this.seq_id=a,c=this.args.slice(0);for(n=o=d.length;n--;)d[n]=0;for(l=0,m=c.length;l<m;++l){k=c[l].seq(a);for(n=o;n--;)d[n]+=k[n]}e=b.mul,f=b.add;if(b.ison){g=b.type,b.freq.seq_id===a?h=b.freq.cell[0]:h=b.freq.seq(a)[0],b.band.seq_id===a?i=b.band.cell
[0]:i=b.band.seq(a)[0],b.gain.seq_id===a?j=b.gain.cell[0]:j=b.gain.seq(a)[0];if(g!==b.prev_type||h!==b.prev_freq||i!==b.prev_band||j!==b.prev_gain)b.set_params.call(this,h,i,j),b.prev_type=g,b.prev_freq=h,b.prev_band=i,b.prev_gain=j;p=b.a1,q=b.a2,r=b.b0,s=b.b1,t=b.b2,u=b.in1,v=b.in2,w=b.out1,x=b.out2;for(l=0,m=d.length;l<m;++l)y=d[l],z=r*y+s*u+t*v-p*w-q*x,z>1?z=1:z<-1&&(z=-1),v=u,u=y,x=w,w=z,d[l]=z;b.in1=u,b.in2=v,b.out1=w,b.out2=x}for(n=o;n--;)d[n]=d[n]*e+f}return d},c.getFilter=function(b){return a.Types[b]},c.setFilter=function(b,c){typeof c=="object"&&typeof c.set_params=="function"&&(typeof c.default_freq!="number"&&(c.default_freq=2e3),typeof c.default_band!="number"&&(c.default_freq=1),typeof c.default_gain!="number"&&(c.default_freq=6),a.Types[b]=c)};return a}();q.Types={},q.Types.lpf={default_freq:800,default_band:1,set_params:function(a,c){var d=this._,e,f,g,h,i,j;e=a*2*Math.PI/b.samplerate,f=Math.cos(e),g=Math.sin(e),i=.34657359027997264*c*e/g,h=g*(Math.exp(i)-Math.exp(-i))*.5,j=1/(1+h),d.a1=-2*f*j,d.a2=(1-h)*j,d.b1=(1-f)*j,d.b2=d.b0=d.b1*.5}},q.Types.hpf={default_freq:5500,default_band:1,set_params:function(a,c){var d=this._,e,f,g,h,i,j;e=a*2*Math.PI/b.samplerate,f=Math.cos(e),g=Math.sin(e),i=.34657359027997264*c*e/g,h=g*(Math.exp(i)-Math.exp(-i))*.5,j=1/(1+h),d.a1=-2*f*j,d.a2=+(1-h)*j,d.b1=-(1+f)*j,d.b2=d.b0=-d.b1*.5}},q.Types.bpf={default_freq:3e3,default_band:1,set_params:function(a,c){var d=this._,e,f,g,h,i,j;e=a*2*Math.PI/b.samplerate,f=Math.cos(e),g=Math.sin(e),i=.34657359027997264*c*e/g,h=g*(Math.exp(i)-Math.exp(-i))*.5,j=1/(1+h),d.a1=-2*f*j,d.a2=(1-h)*j,d.b0=h*j,d.b1=0,d.b2=-d.b0}},q.Types.brf={default_freq:3e3,default_band:1,set_params:function(a,c){var d=this._,e,f,g,h,i,j;e=a*2*Math.PI/b.samplerate,f=Math.cos(e),g=Math.sin(e),i=.34657359027997264*c*e/g,h=g*(Math.exp(i)-Math.exp(-i))*.5,j=1/(1+h),d.a1=-2*f*j,d.a2=+(1-h)*j,d.b0=1,d.b1=-(1+f)*j,d.b2=1}},q.Types.allpass={default_freq:3e3,default_band:1,set_params:function(a,c){var d=this._,e,f,g,h,i,j;e=a*2*Math.PI/b.samplerate,f=Math.cos(e),g=Math.sin(e),i=.34657359027997264*c*e/g,h=g*(Math.exp(i)-Math.exp(-i))*.5,j=1/(1+h),d.a1=-2*f*j,d.a2=+(1-h)*j,d.b0=d.a2,d.b1=d.a1,d.b2=1}},q.Types.peaking={default_freq:3e3,default_band:1,default_gain:6,set_params:function(a,c,d){var e=this._,f,g,h,i,j,k,l,m,n;f=Math.pow(10,d*.025),g=a*2*Math.PI/b.samplerate,h=Math.cos(g),i=Math.sin(g),m=.34657359027997264*c*g/i,j=i*(Math.exp(m)-Math.exp(-m))*.5,k=j*f,l=j/f,n=1/(1+l),e.a1=-2*h*n,e.a2=+(1-l)*n,e.b0=+(1+k)*n,e.b1=e.a1,e.b2=+(1-k)*n}},q.Types.lowboost={default_freq:3e3,default_band:1,default_gain:6,set_params:function(a,c,d){var e=this._,f,g,h,i,j,k,l;f=Math.pow(10,d*.025),g=a*2*Math.PI/b.samplerate,h=Math.cos(g),i=Math.sin(g),j=i*.5*Math.sqrt((f+1/f)*(1/c-1)+2),k=j*Math.sqrt(f)*2,l=1/(f+1+(f-1)*h+k),e.a1=-2*(f-1+(f+1)*h)*l,e.a2=(f+1+(f-1)*h-k)*l,e.b0=(f+1-(f-1)*h+k)*f*l,e.b1=2*(f-1-(f+1)*h)*f*l,e.b2=(f+1-(f-1)*h-k)*f*l}},q.Types.highboost={default_freq:5500,default_band:1,default_gain:6,set_params:function(a,c,d){var e=this._,f,g,h,i,j,k,l;f=Math.pow(10,d*.025),g=a*2*Math.PI/b.samplerate,h=Math.cos(g),i=Math.sin(g),j=i*.5*Math.sqrt((f+1/f)*(1/c-1)+2),k=j*Math.sqrt(f)*2,l=1/(f+1+(f-1)*h+k),e.a1=2*(f-1+(f+1)*h)*l,e.a2=(f+1+(f-1)*h-k)*l,e.b0=(f+1-(f-1)*h+k)*f*l,e.b1=-2*(f-1-(f+1)*h)*f*l,e.b2=(f+1-(f-1)*h-k)*f*l}},b.fn.register("filter",q),b.fn.register("lpf",q,function(a){return new q(["lpf"].concat(a))}),b.fn.register("hpf",q,function(a){return new q(["hpf"].concat(a))}),b.fn.register("bpf",q,function(a){return new q(["bpf"].concat(a))}),b.fn.register("brf",q,function(a){return new q(["brf"].concat(a))}),b.fn.register("allpass",q,function(a){return new q(["allpass"].concat(a))}),b.fn.register("peaking",q,function(a){return new q(["peaking"].concat(a))}),b.fn.register("lowboost",q,function(a){return new q(["lowboost"].concat(a))}),b.fn.register("highboost",q,function(a){return new q(["highboost"].concat(a))});var r=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),a.Types={lpf:0,hpf:1,bpf:2,brf:3},Object.defineProperty(c,"type",{set:function(b){var c;typeof b=="string"&&(c=a.Types[b])!==undefined&&(this._.type=b,this._.mode=c)},get:function(){return this._.type}}),Object.defineProperty(c,"cutoff",{set:function(a){this._.cutoff=b(a)},get:function(){return this._.cutoff}}),Object.defineProperty(c,"Q",{set:function(a){this._.Q=b(a)},get:function(){return this._.Q}}),Object.defineProperty(c,"depth",{set:function(a){this._.depth=b(a)},get:function(){return this._.depth}});var d=function(c){var d,e,f;this._=f={},e=0,typeof c[e]=="string"&&a.Types[c[e]]!==undefined?this.type=c[e++]:this.type="lpf",typeof c[e]=="object"&&c[e].isKr?f.cutoff=c[e++]:typeof c[e]=="number"?f.cutoff=b(c[e++]):f.cutoff=b(800),typeof c[e]=="object"&&c[e].isKr?f.Q=c[e++]:typeof c[e]=="number"?f.Q=b(c[e++]):f.Q=b(.5),typeof c[e]=="object"&&c[e].isKr?f.depth=c[e++]:typeof c[e]=="number"?f.depth=b(c[e++]):f.depth=b(.5),this.args=b.fn.valist.call(this,c.slice(e)),f.prev_cutoff=undefined,f.prev_Q=undefined,f.prev_depth=undefined,f.f=new Float32Array(4),f.mode=0,f.damp=0,f.freq=0};c.clone=function(a){var c,d=this._,e,f,g;c=b("rfilter",d.type),a?(c.cutoff=d.cutoff.clone(a),c.Q=d.Q.clone(a),c.depth=d.depth.clone(a)):(c.cutoff=d.cutoff,c.Q=d.Q,c.depth=d.depth),b.fn.copy_for_clone(this,c,a);return c};var e=function(a,c){var d=this._,e=2*Math.sin(Math.PI*Math.min(.25,a/(b.samplerate*2)));d.damp=Math.min(2*(1-Math.pow(c,.25)),Math.min(2,2/e-e*.5)),d.freq=e};c.seq=function(a){var b=this._,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;d=this.cell;if(a!==this.seq_id){c=this.args.slice(0);for(m=n=d.length;m--;)d[m]=0;for(k=0,l=c.length;k<l;++k){c[k].seq_id===a?j=c[k].cell:j=c[k].seq(a);for(m=n;m--;)d[m]+=j[m]}f=b.mul,g=b.add;if(b.ison){p=b.mode,b.cutoff.seq_id===a?h=b.cutoff.cell[0]:h=b.cutoff.seq(a)[0],b.Q.seq_id===a?i=b.Q.cell[0]:i=b.Q.seq(a)[0];if(h!==b.prev_cutoff||i!==b.prev_Q)e.call(this,h,i),b.prev_cutoff=h,b.prev_Q=i;s=b.depth.seq(a)[0],s!==b.prev_depth&&(b.depth0=Math.cos(.5*Math.PI*s),b.depth1=Math.sin(.5*Math.PI*s)),o=b.f,q=b.damp,r=b.freq,t=b.depth0,u=b.depth1;for(k=0,l=d.length;k<l;++k)v=d[k],o[3]=v-q*o[2],o[0]=o[0]+r*o[2],o[1]=o[3]-o[0],o[2]=r*o[1]+o[2],w=.5*o[p],o[3]=v-q*o[2],o[0]=o[0]+r*o[2],o[1]=o[3]-o[0],o[2]=r*o[1]+o[2],w+=.5*o[p],w=v*t+w*u,d[k]=w;for(k=l;k--;)d[k]=d[k]*f+g}else for(m=n;m--;)d[m]=d[m]*f+g;this.seq_id=a}return d};return a}();b.fn.register("rfilter",r),b.fn.register("rlpf",r,function(a){return new r(["lpf"].concat(a))}),b.fn.register("rhpf",r,function(a){return new r(["hpf"].concat(a))}),b.fn.register("rbpf",r,function(a){return new r(["bpf"].concat(a))}),b.fn.register("rbrf",r,function(a){return new r(["brf"].concat(a))});var s=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"time",{set:function(a){typeof a=="number"&&(this._.delayTime=a)},get:function(){return this._.delayTime}}),Object.defineProperty(c,"fb",{set:function(a){typeof a=="number"&&(this._.feedback=a)},get:function(){return this._.feedback}}),Object.defineProperty(c,"wet",{set:function(a){typeof a=="number"&&(this._.wet=a)},get:function(){return this._.wet}});var d=function(a){var c,d,f;this._=f={},c=Math.ceil(Math.log(b.samplerate*1.5)*Math.LOG2E),f.buffer=new Float32Array(1<<c),f.buffer_mask=(1<<c)-1,f.pointerWrite=0,f.pointerRead=0,f.delayTime=250,f.feedback=.25,f.wet=.25,d=0,typeof a[d]=="number"&&(f.delayTime=a[d++]),typeof a[d]=="number"&&(f.feedback=a[d++]),typeof a[d]=="number"&&(f.wet=a[d++]),e.call(this,f.delayTime,f.feedback,f.wet),this.args=b.fn.valist.call(this,a.slice(d))};c.clone=function(a){var c,d=this._,e,f,g;c=b("efx.delay",d.delayTime,d.feedback,d.wet),b.fn.copy_for_clone(this,c,a);return c};var e=function(a,c,d){var e,f=this._;e=a*b.samplerate/1e3,f.pointerWrite=f.pointerRead+e&f.buffer_mask,c<1?c>-1?f.feedback=c:f.feedback=-0.9990234375:f.feedback=.9990234375,d<0?f.wet=0:d>1?f.wet=1:f.wet=d};c.seq=function(a){var b=this._,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;d=this.cell;if(a!==this.seq_id){this.seq_id=a,c=this.args.slice(0);for(h=i=d.length;h--;)d[h]=0;for(f=0,g=c.length;f<g;++f){e=c[f].seq(a);for(h=i;h--;)d[h]+=e[h]}p=b.buffer,q=b.buffer_mask,m=b.feedback,n=b.wet,o=1-n,r=b.pointerRead,s=b.pointerWrite,j=b.mul,k=b.add;if(b.ison)for(f=0,g=d.length;f<g;++f)l=p[r],p[s]=d[f]-l*m,d[f]*=o,d[f]+=l*n,d[f]=d[f]*j+k,s=s+1&q,r=r+1&q;else for(f=0,g=d.length;f<g;++f)l=p[r],p[s]=d[f]-l*m,s=s+1&q,r=r+1&q,d[f]=d[f]*j+k;b.pointerRead=r,b.pointerWrite=s}return d};return a}();b.fn.register("efx.delay",s);var t=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"pre",{set:function(a){this._.preGain=b(a)},get:function(){return this._.preGain}}),Object.defineProperty(c,"post",{set:function(a){this._.postGain=b(a)},get:function(){return this._.postGain}}),Object.defineProperty(c,"freq",{set:function(a){this._.lpfFreq=b(a)},get:function(){return this._.lpfFreq}});var d=function(a){var c,d;this._=d={},c=0,typeof a[c]=="object"&&a[c].isKr?d.preGain=a[c++]:typeof a[c]=="number"?d.preGain=b(a[c++]):d.preGain=b(-60),typeof a[c]=="object"&&a[c].isKr?d.postGain=a[c++]:typeof a[c]=="number"?d.postGain=b(a[c++]):d.postGain=b(18),typeof a[c]=="object"&&a[c].isKr?d.lpfFreq=a[c++]:typeof a[c]=="number"?d.lpfFreq=b(a[c++]):d.lpfFreq=b(2400),this.args=b.fn.valist.call(this,a.slice(c)),d.prev_preGain=undefined,d.prev_postGain=undefined,d.prev_lpfFreq=undefined,d.in1=d.in2=d.out1=d.out2=0,d.a1=d.a2=0,d.b0=d.b1=d.b2=0};c.clone=function(a){var c,d=this._,e,f,g;c=b("efx.dist",d.preGain,d.postGain,d.lpfFreq),b.fn.copy_for_clone(this,c,a);return c};var e=152587890625e-16,f=function(a,c,d,e){var f=this._,g,h,i,j,k,l,m;g=Math.pow(2,-c/6),f.preScale=Math.pow(2,-a/6)*g,f.limit=g,d&&(h=d*2*Math.PI/b.samplerate,i=Math.cos(h),j=Math.sin(h),l=.34657359027997264*e*h/j,k=j*(Math.exp(l)-Math.exp(-l))*.5,m=1/(1+k),f.a1=-2*i*m,f.a2=(1-k)*m,f.b1=(1-i)*m,f.b2=f.b0=f.b1*.5)};c.seq=function(a){var b=this._,c,d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;c=this.cell;if(a!==this.seq_id){this.seq_id=a,d=this.args.slice(0);for(j=k=c.length;j--;)c[j]=0;for(h=0,i=d.length;h<i;++h){g=d[h].seq(a);for(j=k;j--;)c[j]+=g[j]}q=b.mul,r=b.add;if(b.ison){l=b.preGain.seq(a)[0],m=b.postGain.seq(a)[0],n=b.lpfFreq.seq(a)[0],(l!==b.prev_preGain||m!==b.prev_postGain||n!==b.prev_lpfFreq)&&f.call(this,l,m,n,1),o=b.preScale,p=b.limit;if(b.lpfFreq){s=b.a1,t=b.a2,u=b.b0,v=b.b1,w=b.b2,x=b.in1,y=b.in2,z=b.out1,A=b.out2,z<e&&(A=z=0);for(h=0,i=c.length;h<i;++h)B=c[h]*o,B>p?B=p:B<-p&&(B=-p),C=u*B+v*x+w*y-s*z-t*A,C>1?C=1:C<-1&&(C=-1),y=x,x=B,A=z,z=C,c[h]=C*q+r;b.in1=x,b.in2=y,b.out1=z,b.out2=A}else for(h=0,i=c.length;h<i;++h)B=c[h]*o,B>p?B=p:B<-p&&(B=-p),c[h]=B*q+r}else for(j=k;j--;)c[j]=c[j]*q+r}return c};return a}();b.fn.register("efx.dist",t);var u=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"depth",{set:function(a){var b=this._;typeof a=="number"&&(b.depth=a,b.lfo.mul=b.depth*b.offset)},get:function(){return this._.depth}}),Object.defineProperty(c,"rate",{set:function(a){var b=this._;typeof a=="number"&&(b.rate=a,b.lfo.freq.value=a)},get:function(){return this._.rate}}),Object.defineProperty(c,"wet",{set:function(a){var b=this._;typeof a=="number"&&0<=a&&a<=1&&(b.wet=a,b.wet0=Math.sin(.25*Math.PI*a),b.dry0=Math.cos(.25*Math.PI*a))},get:function(){return this._.wet}});var d=function(a){var c,d,e;this._=e={},c=Math.ceil(Math.log(b.samplerate*.02)*Math.LOG2E),e.buffer=new Float32Array(1<<c),e.buffer_mask=(1<<c)-1,d=0,e.delay=10,e.depth=typeof a[d]=="number"?a[d]:.8,e.rate=typeof a[d]=="number"?a[d]:.5,e.wet=typeof a[d]=="number"?a[d]:.5,e.wet0=Math.sin(.25*Math.PI*e.wet),e.dry0=Math.cos(.25*Math.PI*e.wet),e.sr=b.samplerate/1e3,e.offset=e.sr*e.delay|0,e.pointerRead=0,e.pointerWrite=e.offset,e.lfo=b("sin",e.rate,e.depth*e.offset).kr(),this.args=b.fn.valist.call(this,a.slice(d))};c.clone=function(a){var c,d=this._;c=b("efx.chorus",d.depth,d.rate,d.wet),b.fn.copy_for_clone(this,c,a);return c},c.seq=function(a){var b=this._,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;d=this.cell;if(a!==this.seq_id){this.seq_id=a,c=this.args.slice(0);for(h=i=d.length;h--;)d[h]=0;j=b.buffer,k=b.buffer_mask,l=b.pointerWrite;for(h=0;h<i;++h)j[l]=0,l=l+1&k;l=b.pointerWrite;for(f=0,g=c.length;f<g;++f){e=c[f].seq(a);for(h=0;h<i;++h)j[l]+=e[h],l=l+1&k}v=b.mul,w=b.add;if(b.ison){o=b.wet0,p=b.dry0,q=b.fb,r=b.lfo.seq(a)[0]|0,m=b.pointerRead,n=m+r+j.length&k,l=b.pointerWrite;for(f=0,g=d.length;f<g;++f)s=j[m],t=j[n],u=s*p+t*o,d[f]=u*v+w,m=m+1&k,n=n+1&k,l=l+1&k}else{m=b.pointerRead;for(f=0,g=d.length;f<g;++f)d[f]=j[m]*v+w,m=m+1&k}b.pointerRead=m,b.pointerWrite=l}return d};return a}();b.fn.register("efx.chorus",u);var v={initialize:function(a){var b,c;this._=c={},b=0,c.src=typeof a[b]=="string"?a[b++]:"",c.loop=typeof a[b]=="boolean"?a[b++]:!1,typeof a[b]=="function"&&(c.loop?this.onlooped=a[b++]:this.onended=a[b++]),c.buffer=new Float32Array(0),c.duration=0,c.phase=0,c.reversed=!1,c.isloaded=!1},setPrototype:function(){Object.defineProperty(this,"src",{set:function(a){typeof a=="string"&&this._.src!==a&&(this._.src=a,this._.isloaded=!1)},get:function(){return this._.src}}),Object.defineProperty(this,"loop",{set:function(a){this._.loop=!!a},get:function(){return this._.loop}}),Object.defineProperty(this,"reversed",{set:function(a){var b=this._;b.reversed=!!a,b.reversed&&b.phase===0&&(b.phase=Math.max(0,b.buffer.length-1))},get:function(){return this._.reversed}}),Object.defineProperty(this,"isLoaded",{get:function(){return this._.isloaded}}),Object.defineProperty(this,"duration",{get:function(){return this._.duration}}),Object.defineProperty(this,"currentTime",{set:function(a){var c=this._;typeof a=="number"&&0<=a&&a<=c.duration&&(c.phase=a/1e3*b.samplerate|0)},get:function(){return this._.phase/b.samplerate*1e3}}),this.clone=function(a){var c,d,e=this._;c=Object.getPrototypeOf(this)._.klassname,d=b(c,e.src,e.loop),d._.reversed=e.reversed,d._.isloaded=e.isloaded,d._.buffer=e.buffer,d._.duration=e.duration,d._.phase=e.reversed?Math.max(0,e.buffer.length-1):0,b.fn.copy_for_clone(this,d,a);return d},this.slice=function(a,c){var d,e,f=this._,g,h;d=Object.getPrototypeOf(this)._.klassname,h=f.reversed,typeof a=="number"?a=a/1e3*b.samplerate:a=0,typeof c=="number"?c=c/1e3*b.samplerate:c=f.buffer.length,a>c&&(g=a,a=c,c=g,h=!h),e=b(d),e._.loop=f.loop,e._.reversed=h,e._.buffer=f.buffer.subarray(a,c),e._.duration=(c-a/b.samplerate)*1e3,e._.phase=h?Math.max(0,e._.buffer.length-1):0,b.fn.copy_for_clone(this,e);return e},this.bang=function(){var a=this._;a.phase=a.reversed?Math.max(0,a.buffer.length-1):0,b.fn.do_event(this,"bang");return this},this.seq=function(a){var c=this._,d,e,f,g,h,i;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a,e=c.buffer,f=c.mul,g=c.add;if(c.reversed)for(h=0,i=d.length;h<i;++h)d[h]=(e[c.phase--]||0)*f+g,c.phase<0&&(c.loop?(c.phase=Math.max(0,c.buffer.length-1),b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"));else for(h=0,i=d.length;h<i;++h)d[h]=(e[c.phase++]||0)*f+g,c.phase>=e.length&&(c.loop?(c.phase=0,b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"))}return d};return this}},w=function(){var a=function(){v.initialize.apply(this,arguments)},c=v.setPrototype.call(a.prototype);b.fn.setPrototypeOf.call(c,"ar-only"),c.load=function(){var a=this,c=this._,d,e,f;d=new webkitAudioContext,e=new XMLHttpRequest,f={buffer:null,samplerate:d.sampleRate},c.src!==""?(e.open("GET",c.src,!0),e.responseType="arraybuffer",e.onreadystatechange=function(c){e.readyState===4&&e.status!==200&&b.fn.do_event(a,"error",[e])},e.onload=function(){c.buffer=d.createBuffer(e.response,!0).getChannelData(0),c.duration=c.buffer.length/b.samplerate*1e3,f.buffer=c.buffer,b.fn.do_event(a,"loadedmetadata",[f]),c.isloaded=!0,b.fn.do_event(a,"loadeddata",[f])},e.send()):b.fn.do_event(a,"error",[e]),c.isloaded=!1,c.buffer=new Float32Array(0),c.phase=0;return this};return a}();b.fn.register("-webkit-audio",w);var x=function(){var a=function(){v.initialize.apply(this,arguments)},c=v.setPrototype.call(a.prototype);b.fn.setPrototypeOf.call(c,"ar-only"),c.load=function(a){var c=this,d=this._,e,f,g,h,i;i={buffer:null,samplerate:0},d.src!==""&&(e=new Audio(d.src),e.loop=!1,e.addEventListener("error",function(a){b.fn.do_event(c,"error",[a])},!1),e.addEventListener("loadedmetadata",function(a){e.volume=0,d.buffer=new Float32Array(e.duration*e.mozSampleRate|0),d.duration=e.duration*1e3,g=0,h=e.mozSampleRate/b.samplerate,e.play(),i.buffer=d.buffer,i.samplerate=e.mozSampleRate,b.fn.do_event(c,"loadedmetadata",[i])},!1),e.addEventListener("MozAudioAvailable",function(a){var b,c,e,f;b=a.frameBuffer,c=d.buffer;for(e=0,f=b.length;e<f;e+=h)c[g++]=b[e|0]},!1),e.addEventListener("ended",function(a){d.isloaded=!0,b.fn.do_event(c,"loadeddata",[i])},!1),e.load()),d.isloaded=!1,d.buffer=new Float32Array(0),d.phase=0;return this};return a}();b.fn.register("-moz-audio",x);var y=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"src",{set:function(a){typeof a=="string"&&this._.src!==a&&(this._.src=a,this._.isloaded=!1)},get:function(){return this._.src}}),Object.defineProperty(c,"loop",{set:function(a){this._.loop=!!a},get:function(){return this._.loop}}),Object.defineProperty(c,"reversed",{set:function(a){var b=this._;b.reversed=!!a,b.reversed&&b.phase===0&&(b.phase=Math.max(0,b.buffer.length-1))},get:function(){return this._.reversed}}),Object.defineProperty(c,"isLoaded",{get:function(){return this._.isloaded}}),Object.defineProperty(c,"duration",{get:function(){return this._.duration}}),Object.defineProperty(c,"currentTime",{set:function(a){typeof a=="number"&&0<=a&&a<=this._.duration&&(this._.phase=a/1e3*this._.samplerate)},get:function(){return this._.phase/this._.samplerate*1e3}});var d=function(a){var b,c;this._=c={},b=0,c.src=typeof a[b]=="string"?a[b++]:"",c.loop=typeof a[b]=="boolean"?a[b++]:!1,c.loaded_src=undefined,c.buffer=new Int16Array(0),c.samplerate=0,c.duration=0,c.phaseStep=0,c.phase=0,c.reversed=!1};c.clone=function(a){var c,d=this._;c=b("wav"),c._.src=d.src,c._.loop=d.loop,c._.reversed=d.reversed,c._.isloaded=d.isloaded,c._.loaded_src=d.loaded_src,c._.buffer=d.buffer,c._.samplerate=d.samplerate,c._.duration=d.duration,c._.phaseStep=d.phaseStep,c._.phase=0,b.fn.copy_for_clone(this,c,a);return c},c.slice=function(a,c){var d,e=this._,f,g;typeof a=="number"?a=a/1e3*e.samplerate:a=0,typeof c=="number"?c=c/1e3*e.samplerate:c=e.buffer.length,a>c&&(f=a,a=c,c=f,g=!g),d=b("wav"),d._.src=e.src,d._.loop=e.loop,d._.reversed=e.reversed,d._.isloaded=e.isloaded,d._.loaded_src=e.loaded_src,d._.buffer=e.buffer.subarray(a,c),d._.samplerate=e.samplerate,d._.duration=(c-a/e.samplerate)*1e3,d._.phaseStep=e.phaseStep,d._.phase=g?Math.max(0,d._.buffer.length-1):0,b.fn.copy_for_clone(this,d);return d};var e=function(a,c,d){a==="loadedmetadata"?b.fn.do_event(this,"loadedmetadata",[c]):a==="loadeddata"?(typeof d=="function"?d.call(this,c):typeof d=="object"&&c.buffer&&(d.self=this,d.samplerate=c.samplerate,d.duration=c.buffer.length/samplerate*1e3,d.buffer=c.buffer,console.log("wav.load: done.")),b.fn.do_event(this,"loadeddata",[c])):a==="error"&&(typeof d=="function"?d.call(this,"error"):typeof d=="object"&&console.log("wav.load: error."),b.fn.do_event(this,"error"))};c.load=function(a){var c=this,d=this._,f,g,h,i,j;d.loaded_src===d.src?d.samplerate===0?e.call(this,"error",{},a):(e.call(this,"loadedmetadata",{samplerate:d.samplerate,buffer:d.buffer},a),e.call(this,"loadeddata",{samplerate:d.samplerate,buffer:d.buffer},a)):d.src!==""?(b.fn.do_event(this,"loading"),b.platform==="web"&&b._.workerpath?(g=b.utils.relpath2rootpath(d.src),f=new Worker(b._.workerpath),f.onmessage=function(f){var g=f.data;switch(g.result){case"metadata":i=new Int16Array(g.bufferSize),j=g.samplerate,d.buffer=i,d.samplerate=j,e.call(c,"loadedmetadata",{samplerate:d.samplerate,buffer:d.buffer},a);break;case"data":i.set(g.array,g.offset);break;case"ended":d.isloaded=!0,d.loaded_src=d.src,d.duration=i.length/j*1e3,d.phaseStep=j/b.samplerate,d.reversed?d.phase=Math.max(0,newone._.buffer.length-1):d.phase=0,e.call(c,"loadeddata",{samplerate:j,buffer:i},a);break;default:e.call(c,"error",{},a)}},f.postMessage({action:"wav.decode",src:g})):b.utils.binary.load(d.src,function(f){b.utils.wav.decode(f,function(f){f.err?(d.loaded_src=undefined,d.buffer=new Int16Array(0),d.samplerate=0,d.duration=0,d.phaseStep=0,d.phase=0,e.call(c,"error",{},a)):(d.isloaded=!0,d.loaded_src=d.src,d.buffer=f.buffer,d.samplerate=f.samplerate,d.duration=f.buffer.length/f.samplerate*1e3,d.phaseStep=f.samplerate/b.samplerate,d.reversed?d.phase=Math.max(0,newone._.buffer.length-1):d.phase=0,e.call(c,"loadedmetadata",{samplerate:d.samplerate,buffer:d.buffer},a),e.call(c,"loadeddata",{samplerate:d.samplerate,buffer:d.buffer},a))})})):e.call(this,{},a),this._.isloaded=!1;return this},c.bang=function(){this._.phase=0,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l,m,n,o;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a,e=c.mul,f=c.add,g=c.buffer,i=c.phaseStep;if(c.reversed)for(n=0,o=d.length;n<o;++n)j=c.phase|0,k=c.phase-j,l=(g[j-1]||0)/32768,m=(g[j]||0)/32768,d[n]=((1-k)*l+k*m)*e+f,c.phase-=i,c.phase<0&&(c.loop?(c.phase=Math.max(0,c.buffer.length-1),b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"));else for(n=0,o=d.length;n<o;++n)j=c.phase|0,k=c.phase-j,l=(g[j]||0)/32768,m=(g[j+1]||0)/32768,d[n]=((1-k)*l+k*m)*e+f,c.phase+=i,c.phase>=g.length&&(c.loop?(c.phase=0,b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"))}return d};return a}();b.fn.register("wav",y);var z=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-kr");var d=function(a){this.args=b.fn.valist.call(this,a)};c._.init=function(){c._._play=this.play,c._._pause=this.pause,c._._on=this.on,c._._off=this.off,c._._bang=this.bang,this.play=c._.play,this.pause=c._.pause,this.on=c._.on,this.off=c._.off,this.bang=c._.$bang},c.clone=function(a){var c=b("buddy");b.fn.copy_for_clone(this,c,a);return c},c._.play=function(){var a,d,e;a=this.args.slice(0);for(d=0,e=a.length;d<e;++d)b.fn.do_event(a[d],"play");return c._._play.call(this)},c._.pause=function(){var a,d,e;a=this.args.slice(0);for(d=0,e=a.length;d<e;++d)b.fn.do_event(a[d],"pause");return c._._pause.call(this)},c._.on=function(){var a,b,d;a=this.args.slice(0);for(b=0,d=a.length;b<d;++b)a[b].on();return c._._on.call(this)},c._.off=function(){var a,b,d;a=this.args.slice(0);for(b=0,d=a.length;b<d;++b)a[b].off();return c._._off.call(this)},c._.$bang=function(){var a,b,d;a=this.args.slice(0);for(b=0,d=a.length;b<d;++b)a[b].bang();return c._._bang.call(this)},c.send=function(a,b){var c,d,e;c=this.args.slice(0);for(d=0,e=c.length;d<e;++d)typeof c[d][a]=="function"&&c[d][a].apply(c[d],b);return this},c.seq=function(a){var c=this._,d,e,f,g,h,i,j,k,l;e=this.cell;if(a!==this.seq_id){this.seq_id=a,f=c.mul,g=c.add,l=b.cellsize,d=this.args.slice(0);if(c.ar){for(k=l;k--;)e[k]=0;for(i=0,j=d.length;i<j;++i){h=d[i].seq(a);for(k=l;k--;)e[k]+=h[k]}for(k=l;k--;)e[k]=e[k]*f+g}else{h=0;for(i=0,j=d.length;i<j;++i)h+=d[i].seq(a)[0];h=h*f+g;for(k=l;k--;)e[k]=h}}return e};return a}();b.fn.register("buddy",z);var A={setPrototype:function(){Object.defineProperty(this,"type",{set:function(a){var b;typeof a=="string"?(b=A.Functions[a])!==undefined&&(this._.type=a,this._.func=b):typeof a=="function"&&(this._.type="function",this._.func=a)},get:function(){return this._.type}}),Object.defineProperty(this,"delay",{set:function(a){typeof a=="number"&&(this._.delay=a)},get:function(){return this._.delay}}),Object.defineProperty(this,"duration",{set:function(a){typeof a=="number"&&(this._.duration=a)},get:function(){return this._.duration}}),Object.defineProperty(this,"currentTime",{get:function(){return this._.currentTime}}),this.seq=function(a){var c=this._,d,e,f,g,h;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a;while(c.samples<=0){if(c.status===0){c.status=1,c.samples=b.samplerate*(c.duration/1e3)|0,c.x0=0,c.dx=b.cellsize/c.samples;continue}if(c.status===1){c.status=2,c.samples=Infinity,c.x0=1,c.dx=0,e=c.func(1),c.value=(e*(c.stop-c.start)+c.start)*c.mul+c.add,b.fn.do_event(this,"ended");continue}}if(c.status!==2){e=c.status===1?c.func(c.x0):0,f=(e*(c.stop-c.start)+c.start)*c.mul+c.add;for(g=0,h=b.cellsize;g<h;++g)d[g]=f;c.status===1&&b.fn.do_event(this,"changed",[f]),c.value=f,c.x0+=c.dx,c.samples-=h}else{f=c.value;for(g=0,h=b.cellsize;g<h;++g)d[g]=f}c.currentTime+=h*1e3/b.samplerate}return d},this.getFunction=function(a){return A.Functions[a]},this.setFunction=function(a,b){typeof b=="function"&&(A.Functions[a]=b)};return this}};A.Functions={linear:function(a){return a},"quadratic.in":function(a){return a*a},"quadratic.out":function(a){return a*(2-a)},"quadratic.inout":function(a){if((a*=2)<1)return.5*a*a;return-0.5*(--a*(a-2)-1)},"cubic.in":function(a){return a*a*a},"cubic.out":function(a){return--a*a*a+1},"cubic.inout":function(a){if((a*=2)<1)return.5*a*a*a;return.5*((a-=2)*a*a+2)},"quartic.in":function(a){return a*a*a*a},"quartic.out":function(a){return 1- --a*a*a*a},"quartic.inout":function(a){if((a*=2)<1)return.5*a*a*a*a;return-0.5*((a-=2)*a*a*a-2)},"quintic.in":function(a){return a*a*a*a*a},"quintic.out":function(a){return--a*a*a*a*a+1},"quintic.inout":function(a){if((a*=2)<1)return.5*a*a*a*a*a;return.5*((a-=2)*a*a*a*a+2)},"sinusoidal.in":function(a){return 1-Math.cos(a*Math.PI/2)},"sinusoidal.out":function(a){return Math.sin(a*Math.PI/2)},"sinusoidal.inout":function(a){return.5*(1-Math.cos(Math.PI*a))},"exponential.in":function(a){return a===0?0:Math.pow(1024,a-1)},"exponential.out":function(a){return a===1?1:1-Math.pow(2,-10*a)},"exponential.inout":function(a){if(a===0)return 0;if(a===1)return 1;if((a*=2)<1)return.5*Math.pow(1024,a-1);return.5*(-Math.pow(2,-10*(a-1))+2)},"circular.in":function(a){return 1-Math.sqrt(1-a*a)},"circular.out":function(a){return Math.sqrt(1- --a*a)},"circular.inout":function(a){if((a*=2)<1)return-0.5*(Math.sqrt(1-a*a)-1);return.5*(Math.sqrt(1-(a-=2)*a)+1)},"elastic.in":function(a){var b,c=.1,d=.4;if(a===0)return 0;if(a===1)return 1;!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI);return-(c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d))},"elastic.out":function(a){var b,c=.1,d=.4;if(a===0)return 0;if(a===1)return 1;!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI);return c*Math.pow(2,-10*a)*Math.sin((a-b)*2*Math.PI/d)+1},"elastic.inout":function(a){var b,c=.1,d=.4;if(a===0)return 0;if(a===1)return 1;!c||c<1?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI);if((a*=2)<1)return-0.5*c*Math.pow(2,10*(a-=1))*Math.sin((a-b)*2*Math.PI/d);return c*Math.pow(2,-10*(a-=1))*Math.sin((a-b)*2*Math.PI/d)*.5+1},"back.in":function(a){var b=1.70158;return a*a*((b+1)*a-b)},"back.out":function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},"back.inout":function(a){var b=2.5949095;if((a*=2)<1)return.5*a*a*((b+1)*a-b);return.5*((a-=2)*a*((b+1)*a+b)+2)},"bounce.in":function(a){return 1-A.Functions["bounce.out"](1-a)},"bounce.out":function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},"bounce.inout":function(a){if(a<.5)return A.Functions["bounce.in"](a*2)*.5;return A.Functions["bounce.out"](a*2-1)*.5+.5}};var B=function(){var a=function(){d.apply(this,arguments)},c=A.setPrototype.call(a.prototype);b.fn.setPrototypeOf.call(c,"kr-only"),Object.defineProperty(c,"start",{set:function(a){typeof a=="number"&&(this._.start=a)},get:function(){return this._.start}}),Object.defineProperty(c,"stop",{set:function(a){typeof a=="number"&&(this._.stop=a)},get:function(){return this._.stop}}),Object.defineProperty(c,"value",{get:function(){return this._.value}});var d=function(a){var b,c;this._=c={},b=0,typeof a[b]=="string"&&A.Functions[a[b]]!==undefined?this.type=a[b++]:typeof a[b]=="function"?this.type=a[b++]:this.type="linear",c.duration=typeof a[b]=="number"?a[b++]:1e3,c.start=typeof a[b]=="number"?a[b++]:0,c.stop=typeof a[b]=="number"?a[b++]:1,typeof a[b]=="function"&&(this.onchanged=a[b++]),c.delay=0,c.status=-1,c.value=0,c.samples=Infinity,c.x0=0,c.dx=0,c.currentTime=0};c.clone=function(a){var c,d=this._;c=b("ease"),c._.type=d.type,c._.func=d.func,c._.duration=d.duration,c._.value=d.value,c._.start=d.start,c._.stop=d.stop,b.fn.copy_for_clone(this,c,a);return c},c.bang=function(){var a=this._;a.status=0,a.value=0,a.samples=b.samplerate*(a.delay/1e3)|0,a.x0=0,a.dx=0,a.currentTime=0,b.fn.do_event(this,"bang");return this};return a}();b.fn.register("ease",B);var C=function(){var a=function(){d.apply(this,arguments)},c=A.setPrototype.call(a.prototype);b.fn.setPrototypeOf.call(c,"kr-only"),Object.defineProperty(c,"value",{set:function(a){var c=this._;typeof a=="number"&&(c.status=0,c.start=c.value,c.stop=a,c.samples=b.samplerate*(c.delay/1e3)|0,c.x0=0,c.dx=0)},get:function(){return this._.value}});var d=function(a){var b,c;this._=c={},b=0,typeof a[b]=="string"&&A.Functions[a[b]]!==undefined?this.type=a[b++]:typeof a[b]=="function"?this.type=a[b++]:this.type="linear",c.duration=typeof a[b]=="number"?a[b++]:1e3,c.value=typeof a[b]=="number"?a[b++]:0,typeof a[b]=="function"&&(this.onchanged=a[b++]),c.delay=0,c.status=-1,c.start=c.value,c.stop=c.value,c.samples=Infinity,c.x0=0,c.dx=0,c.currentTime=0};c.clone=function(a){var c,d=this._;c=b("glide"),c._.type=d.type,c._.func=d.func,c._.duration=d.duration,c._.value=d.value,c._.start=d.value,c._.stop=d.value,b.fn.copy_for_clone(this,c,a);return c},c.bang=function(){var a=this._;a.status=0,a.start=a.value,a.stop=a.value,a.samples=b.samplerate*(a.delay/1e3)|0,a.x0=0,a.dx=0,a.currentTime=0,b.fn.do_event(this,"bang");return this};return a}();b.fn.register("glide",C);var D=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),b.fn.setPrototypeOf.call(c,"listener"),Object.defineProperty(c,"buffer",{get:function(){return this._.buffer}}),Object.defineProperty(c,"recTime",{set:function(a){var c=this._;typeof a=="number"&&a>0&&(c.recTime=a,c.buffer=new Float32Array(b.samplerate*c.recTime/1e3|0))},get:function(){return this._.recTime}}),Object.defineProperty(c,"currentTime",{get:function(){return this._.index/b.samplerate*1e3}}),Object.defineProperty(c,"isRecording",{get:function(){return this._.ison}}),Object.defineProperty(c,"overwrite",{set:function(a){this._.overwrite=!!a},get:function(){return this._.overwrite}});var d=function(a){var c,d;this._=d={},c=0,typeof a[c]=="number"&&a[c]>0?d.recTime=a[c++]:d.recTime=1e3,typeof a[c]=="function"&&(this.onrecorded=a[c++]),this.args=b.fn.valist.call(this,a.slice(c)),d.buffer=new Float32Array(b.samplerate*d.recTime/1e3|0),d.index=d.currentTime=0,d.overwrite=!1};c.on=function(){var a,c,d=this._;d.ison=!0;if(d.index>=d.buffer.length){d.index=d.currentTime=0;if(!d.overwrite){a=d.buffer;for(c=a.length;c--;)a[c]=0}}b.fn.do_event(this,"on");return this},c.off=function(){this._.ison&&e.call(this),this._.ison=!1,b.fn.do_event(this,"off");return this},c.bang=function(){var a,c,d=this._;d.index=d.currentTime=0;if(!d.overwrite){a=d.buffer;for(c=a.length;c--;)a[c]=0}b.fn.do_event(this,"bang");return this};var e=function(){var a=this._;b.fn.do_event(this,"recorded",[a.buffer.subarray(0,a.index)])};c.seq=function(a){var c=this._,d,f,g,h,i,j,k,l,m,n;f=this.cell;if(a!==this.seq_id){this.seq_id=a,g=c.buffer,h=c.mul,i=c.add,n=b.cellsize;for(m=n;m--;)f[m]=0;d=this.args.slice(0);for(k=0,l=d.length;k<l;++k){j=d[k].seq(a);for(m=n;m--;)f[m]+=j[m]}if(c.ison){for(m=0;m<n;++m)g[c.index++]=f[m],f[m]=f[m]*h+i;c.index>=g.length&&(c.ison=!1,e.call(this),b.fn.do_event(this,"ended"))}else for(m=n;m--;)f[m]=f[m]*h+i}return f};return a}();b.fn.register("rec",D);var E=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"buffer",{set:function(a){var c,d,e=this._;if(typeof a=="object")if(a instanceof Float32Array)e.buffer=a;else if(a instanceof Array||a.buffer instanceof ArrayBuffer){c=new Float32Array(a.length);for(d=c.length;d--;)c[d]=a[d];e.buffer=c,e.duration=c.length/b.samplerate*1e3,e.reversed?e.phase=Math.max(0,e.buffer.length-1):e.phase=0}},get:function(){return this._.buffer}}),Object.defineProperty(c,"loop",{set:function(a){this._.loop=!!a},get:function(){return this._.loop}}),Object.defineProperty(c,"reversed",{set:function(a){var b=this._;b.reversed=!!a,b.reversed&&b.phase===0&&(b.phase=Math.max(0,b.buffer.length-1))},get:function(){return this._.reversed}}),Object.defineProperty
(c,"duration",{get:function(){return this._.duration}}),Object.defineProperty(c,"currentTime",{set:function(a){typeof a=="number"&&0<=a&&a<=this._.duration&&(this._.phase=a/1e3*this._.samplerate)},get:function(){return this._.phase/this._.samplerate*1e3}});var d=function(a){var c,d,e,f,g;this._=g={},e=0;if(typeof a[e]=="object")if(a[e]instanceof Float32Array)c=a[e++];else if(a[e]instanceof Array||a[e].buffer instanceof ArrayBuffer){d=a[e++],c=new Float32Array(d.length);for(f=c.length;f--;)c[f]=d[f]}c===undefined&&(c=new Float32Array(0)),g.loop=typeof a[e]=="boolean"?a[e++]:!1,g.buffer=c,g.duration=c.length/b.samplerate*1e3,g.phase=0,g.reversed=!1};c.clone=function(a){var c,d=this._;c=b("buffer",d.buffer,d.loop),c._.reversed=d.reversed,c._.phase=d.reversed?Math.max(0,d.buffer.length-1):0,b.fn.copy_for_clone(this,c,a);return c},c.slice=function(a,c){var d,e=this._,f,g;g=e.reversed,typeof a=="number"?a=a/1e3*b.samplerate:a=0,typeof c=="number"?c=c/1e3*b.samplerate:c=e.buffer.length,a>c&&(f=a,a=c,c=f,g=!g),d=b("buffer"),d._.loop=e.loop,d._.reversed=g,d._.buffer=e.buffer.subarray(a,c),d._.duration=(c-a/b.samplerate)*1e3,d._.phase=g?Math.max(0,d._.buffer.length-1):0,b.fn.copy_for_clone(this,d);return d},c.bang=function(){var a=this._;a.phase=a.reversed?Math.max(0,a.buffer.length-1):0,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f,g,h,i;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a,e=c.buffer,f=c.mul,g=c.add;if(c.reversed)for(h=0,i=d.length;h<i;++h)d[h]=(e[c.phase--]||0)*f+g,c.phase<0&&(c.loop?(c.phase=Math.max(0,c.buffer.length-1),b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"));else for(h=0,i=d.length;h<i;++h)d[h]=(e[c.phase++]||0)*f+g,c.phase>=e.length&&(c.loop?(c.phase=0,b.fn.do_event(this,"looped")):b.fn.do_event(this,"ended"))}return d};return a}();b.fn.register("buffer",E);var F=function(){var a=function(){e.apply(this,arguments)},c=a.prototype,d=Math.PI*2;b.fn.setPrototypeOf.call(c,"ar-only"),b.fn.setPrototypeOf.call(c,"listener"),Object.defineProperty(c,"size",{get:function(){return this._.buffersize>>1}}),Object.defineProperty(c,"window",{set:function(b){var c;typeof b=="string"?(c=a.WindowFunctions[b])!==undefined&&(this._.window=b,this._.windowfunc=c):typeof b=="function"&&(this._.window="function",this._.windowfunc=b)},get:function(){return this._.window}}),Object.defineProperty(c,"interval",{set:function(a){var c=this._;typeof a=="number"&&(c.interval=a,c.interval_samples=b.samplerate*(a/1e3)|0,c.interval_samples<c.buffersize&&(c.interval_samples=c.buffersize,c.interval=c.buffersize*b.samplerate/1e3))},get:function(){return this._.interval}}),Object.defineProperty(c,"spectrum",{get:function(){return this._.spectrum}}),Object.defineProperty(c,"noSpectrum",{set:function(a){this._.noSpectrum=!!a},get:function(){return this._.noSpectrum}});var e=function(c){var e,f,g,h,i,j;this._=g={},f=0,e=typeof c[f]=="number"?c[f++]:512,e<256?e=256:2048<e&&(e=2048),e=1<<Math.ceil(Math.log(e)*Math.LOG2E),typeof c[f]=="string"&&a.WindowFunctions[c[f]]!==undefined?this.window=c[f++]:this.window="Hann",typeof c[f]=="function"&&(this.onfft=c[f++]),b.fn.valist.call(this,c.slice(f)),this.interval=100,g.status=0,g.samples=0,g.buffersize=e,g.samplerate=b.samplerate,g.buffer=new Float32Array(e),g.index=0,g.real=new Float32Array(e),g.imag=new Float32Array(e),g.bitrev=function(){var a,b,c,d,f;a=new Int16Array(e),f=e>>1,b=c=0;for(;;){a[b]=c;if(++b>=e)break;d=f;while(d<=c)c-=d,d>>=1;c+=d}return a}(),j=Math.floor(Math.log(e)/Math.LN2),h=new Float32Array((1<<j)-1),i=new Float32Array((1<<j)-1);for(f=h.length;f--;)h[f]=Math.sin(d*(f/e)),i[f]=Math.cos(d*(f/e));g.sintable=h,g.costable=i,g.noSpectrum=!1,g.spectrum=new Float32Array(e>>1)};c.clone=function(a){var c,d=this._;c=b("fft",d.buffersize),c._.window=d.window,c._.windowfunc=d.windowfunc,c._.interval=d.interval,c._.interval_samples=d.interval_samples;return c},c.seq=function(a){var b=this._,c,d,e,g,h,i,j,k,l,m;d=this.cell;if(a!==this.seq_id){this.seq_id=a,c=this.args.slice(0);for(j=k=d.length;j--;)d[j]=0;for(i=c.length;i--;){h=c[i].seq(a);for(j=k;j--;)d[j]+=h[j]}l=b.buffer,m=b.buffersize;for(j=0;j<k;++j)b.samples<=0&&b.status===0&&(b.status=1,b.samples+=b.interval_samples,b.index=0),b.status===1&&(l[b.index++]=d[j],m<=b.index&&(b.ison&&f.call(this,l),b.status=0)),--b.samples}return d};var f=function(a){var c=this._,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;d=c.bitrev,e=c.real,f=c.imag,g=c.sintable,h=c.costable,i=c.windowfunc,l=c.buffersize;for(j=l;j--;)a[j]*=i(j/l);for(j=l;j--;)e[j]=a[d[j]],f[j]=0;for(n=1;n<l;n=o){p=0,o=n+n,q=l/o;for(k=0;k<n;k++){r=h[p],s=g[p];for(j=k;j<l;j+=o)t=j+n,u=s*f[t]+r*e[t],v=r*f[t]-s*e[t],e[t]=e[j]-u,e[j]+=u,f[t]=f[j]-v,f[j]+=v;p+=q}}if(!c.noSpectrum){A=Math.sqrt,z=c.spectrum,m=l>>1;for(j=l;j--;)w=e[j],x=f[j],y=l*A(w*w+x*x),z[j]=y}b.fn.do_event(this,"fft",[e,f])};c.getWindowFunction=function(b){return a.WindowFunctions[b]},c.setWindowFunction=function(b,c){typeof value=="function"&&(a.WindowFunctions[b]=c)};return a}();b.fn.register("fft",F),F.WindowFunctions={},function(){var a=Math.PI*2;F.WindowFunctions.Hann=function(b){return.5*(1-Math.cos(a*b))}}();var G=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only"),b.fn.setPrototypeOf.call(c,"timer"),Object.defineProperty(c,"interval",{set:function(a){typeof a=="number"&&a>0&&(this._.interval=a,this._.interval_samples=b.samplerate*(a/1e3)|0)},get:function(){return this._.interval}}),Object.defineProperty(c,"count",{get:function(){return this._.count}}),Object.defineProperty(c,"currentTime",{get:function(){return this._.currentTime}});var d=function(a){var c,d;this._=d={},c=0,typeof a[c]=="number"?this.interval=a[c++]:this.interval=1e3,this.args=b.fn.valist.call(this,a.slice(c)),d.ison=!1,d.samples=0,d.count=0,d.currentTime=0};c.clone=function(a){return b("interval",this._.interval)},c.bang=function(){var a=this._;a.samples=0,a.count=0,a.currentTime=0,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f;if(a!==this.seq_id){this.seq_id=a,c.samples-=b.cellsize;if(c.samples<=0){c.samples+=c.interval_samples,d=this.args.slice(0);for(e=0,f=d.length;e<f;++e)d[e].bang();++c.count}c.currentTime+=b.cellsize*1e3/b.samplerate}return this.cell};return a}();b.fn.register("interval",G);var H=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"kr-only"),b.fn.setPrototypeOf.call(c,"timer"),Object.defineProperty(c,"timeout",{set:function(a){typeof a=="number"&&a>0&&(this._.timeout=a,this._.timeout_samples=b.samplerate*(a/1e3)|0)},get:function(){return this._.timeout}}),Object.defineProperty(c,"currentTime",{get:function(){return this._.currentTime}});var d=function(a){var c,d;this._=d={},c=0,typeof a[c]=="number"?this.timeout=a[c++]:this.timeout=1e3,this.args=b.fn.valist.call(this,a.slice(c)),d.ison=!1,d.samples=0,d.currentTime=0};c.clone=function(a){return b("timeout",this._.timeout)},c._.on=function(){this._.samples=this._.timeout_samples},c.bang=function(){var a=this._;a.samples=a.timeout_samples,a.currentTime=0,b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f;if(a!==this.seq_id){this.seq_id=a,c.samples-=b.cellsize;if(c.samples<=0){c.samples=0,d=this.args.slice(0);for(e=0,f=d.length;e<f;++e)d[e].bang();c.samples<=0&&this.off()}c.currentTime+=b.cellsize*1e3/b.samplerate}return this.cell};return a}();b.fn.register("timeout",H);var I=function(){var a=function(){d.apply(this,arguments)},c=a.prototype;b.fn.setPrototypeOf.call(c,"ar-only"),Object.defineProperty(c,"version",{set:function(b){var c,d=this._;typeof b=="string"&&b!==d.version&&(c=a.Versions[b])!==undefined&&(d.version=b,d.synth&&d.synth.destroy&&d.synth.destroy(this),d.synth=c(this))},get:function(){return this._.version}});var d=function(b){var c,d;this._=d={},c=0,typeof b[c]=="string"&&a.Versions[b[c]]!==undefined?this.version=b[c++]:this.version="0.1"};c.clone=function(a){var c;c=b("timbre",this._.version),b.fn.copy_for_clone(this,c,a);return c},c.bang=function(){this._.synth&&this._.synth.bang(),b.fn.do_event(this,"bang");return this},c.seq=function(a){var c=this._,d,e,f,g,h,i;if(!c.ison)return b._.none;d=this.cell;if(a!==this.seq_id){this.seq_id=a;if(c.synth){g=c.synth.seq(a),e=c.mul,f=c.add;for(h=g.length;h--;)d[h]=g[h]*e+f}}return d};return a}();b.fn.register("timbre",I),I.Versions={},I.Versions["0.1"]=function(a){var b=T("+");b.onbang=function(){var a,c,d;a=T("*"),c=T("pulse",987.7666,.25),d=T("adsr",0,80,1,720).bang(),a.append(c,d),d.onS=function(){c.freq.value=1318.5102,d.keyoff()},d.onended=function(){b.remove(a)},b.append(a)};return b},b.utils=function(a){var b={$exports:{}};b.mtof=function(){var a=function(){var a=new Float32Array(128);for(var b=0;b<128;b++)a[b]=440*Math.pow(Math.pow(2,1/12),b-69);return a}();return function(b){return 0<=b&&b<128?a[b|0]:0}}(),b.ftom=function(a){return Math.round(Math.log(a/440)*Math.LOG2E*12+69)},b.mtoa=function(){var a=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return function(b){var c=(b|0)%12,d=(b|0)/12;return a[c]+((d|0)-2)}}(),b.ftoa=function(a){return b.mtoa(b.ftom(a))},b.atom=function(){var a=/^([CDEFGAB])([-+#b]?)([0-9]?)$/,b={C:0,D:2,E:4,F:5,G:7,A:9,B:11};return function(c){var d,e=0;if((d=c.match(a))!==null){e=b[d[1]];switch(d[2]){case"+":case"#":++e;break;case"-":case"b":--e}e+=12*((d[3]|0)+2)}return e}}(),b.atof=function(a){return b.mtof(b.atom(a))},b.bpm2msec=function(a,b){typeof b=="undefined"&&(b=4);return 60/a*(4/b)*1e3},b.msec2bpm=function(a,b){typeof b=="undefined"&&(b=4);return 60/(a/1e3)*(4/b)},b.msec2hz=function(a){return 1e3/a},b.hz2msec=function(a){return 1e3/a},b.bpm2hz=function(a,b){typeof b=="undefined"&&(b=4);return 1e3/(60/a*(4/b)*1e3)},b.hz2bpm=function(a,b){typeof b=="undefined"&&(b=4);return 60/(1e3/msec/1e3)*(4/b)},b.$exports.converter=["mtof","ftom","mtoa","ftoa","atom","atof","bpm2msec","msec2bpm","msec2hz","msec2hz","bpm2hz","hz2bpm"],b.wavb=function(a){var b,c,d,e,f,g;b=new Float32Array(1024);for(c=f=0,d=a.length/2;c<d;++c){g=parseInt(a.substr(c*2,2),16),g=g&128?(g-256)/128:g/127;for(e=1024/d;e--;)b[f++]=g}return b},function(b){var c=function(a,b){typeof a=="function"?a(b):typeof a=="object"&&(a.buffer=b)},d=function(a,b){if(typeof a=="string"){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onload=function(){c(b,d.response)},d.send()}};b.load=function(b,c){if(typeof c=="function"||typeof c=="object")a.platform==="web"?d(b,c):a.platform!=="node"}}(b.binary={}),function(a){var b=function(a,b,c,d){typeof c=="function"?c({samplerate:a,buffer:b,err:d}):typeof c=="object"&&(c.samplerate=a,c.buffer=b,c.err=d)};a.decode=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(!a instanceof ArrayBuffer)b(0,null,c,"TypeError: wave.decode is expected an ArrayBuffer");else{a=new Uint8Array(a);if(a[0]!==82||a[1]!==73||a[2]!==70||a[3]!==70){b(0,null,c,"HeaderError: not exists 'RIFF'");return}g=a[4]+(a[5]<<8)+(a[6]<<16)+(a[7]<<24);if(g+8!==a.length){b(0,null,c,"HeaderError: invalid data size");return}if(a[8]!==87||a[9]!==65||a[10]!==86||a[11]!==69){b(0,null,c,"HeaderError: not exists 'WAVE'");return}if(a[12]!==102||a[13]!==109||a[14]!==116||a[15]!==32){b(0,null,c,"HeaderError: not exists 'fmt '");return}i=a[16]+(a[17]<<8)+(a[18]<<16)+(a[19]<<24),j=a[20]+(a[21]<<8),k=a[22]+(a[23]<<8),l=a[24]+(a[25]<<8)+(a[26]<<16)+(a[27]<<24),m=a[28]+(a[29]<<8)+(a[30]<<16)+(a[31]<<24),n=a[32]+(a[33]<<8),o=a[34]+(a[35]<<8);if(a[36]!==100||a[37]!==97||a[38]!==116||a[39]!==97){b(0,null,c,"HeaderError: not exists 'data'");return}h=a[40]+(a[41]<<8)+(a[42]<<16)+(a[43]<<24),p=(h/k>>1)/l;if(h>a.length-44){b(0,null,c,"HeaderError: not exists data");return}d=new Int16Array(p*l|0),o===8?q=new Int8Array(a.buffer,44):o===16?q=new Int16Array(a.buffer,44):o===32?q=new Int32Array(a.buffer,44):o===24&&(q=function(){var b,c,d,e,f,g,h,i,j;b=new Int32Array((a.length-44)/3),j=0;for(h=44,i=a.length;h<i;)c=a[h++],d=a[h++],e=a[h++],f=c+(d<<8)+(e<<16),g=f&8388608?-((f^16777215)+1):f,b[j++]=g;return b}());if(q){if(k===1){(function(){var a,e,f;e=1/(1<<o-1)*32768,f=1/((1<<o-1)-1)*32767;for(a=d.length;a--;)d[a]=q[a]*(q[a]<0?e:f);b(l,d,c)})();return}if(k===2){(function(){var a,e,f,g,h,i,j,k;j=1/(1<<o-1),k=1/((1<<o-1)-1);for(a=e=0,f=d.length;e<f;a+=2,++e)h=q[a]*(q[a]<0?j:k),i=q[a+1]*(q[a+1]<0?j:k),g=(h+i)*.5,d[e]=g*(g<0?32768:32767);b(l,d,c)})();return}}b(0,null,c,"not implementation")}}}(b.wav={}),b.exports=function(c){var d,e,f,g=[];if((d=b.$exports[c])!==undefined)for(e=d.length;e--;)f=d[e],a.context[f]=b[f],g.unshift(f);return g.join(",")};return b}(b),typeof window=="object"&&function(a,b){var c=function(){var b=function(){e.apply(this,arguments)},c=b.prototype,d=function(){var b,c,d;b=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,c=a.URL||a.webkitURL;if(b&&c){d=new b,d.append("onmessage=t=function(e){clearInterval(t);if(i=e.data)t=setInterval(function(){postMessage(0)},i)}");return c.createObjectURL(d.getBlob())}return null}(),e=function(){d?this._timer=new Worker(d):this._timer=null,this._timerId=0,this._ugly_patch=0};c.setInterval=function(b,c){this._timer!==null?(this._timer.onmessage=b,this._timer.postMessage(c),/mac.*firefox/i.test(a.navigator.userAgent)&&(a.clearInterval(this._ugly_patch),this._ugly_patch=a.setInterval(function(){},1e3))):(this._timerId!==0&&a.clearInterval(this._timerId),this._timerId=a.setInterval(b,c))},c.clearInterval=function(){this._timer!==null?(this._timer.postMessage(0),this._ugly_patch&&(a.clearInterval(this._ugly_patch),this._ugly_patch=0)):this._timerId!==0&&(a.clearInterval(this._timerId),this._timerId=0)};return b}(),d=function(a){var c,d,e;c=new webkitAudioContext,b.samplerate=c.sampleRate,d=c.createJavaScriptNode(a.streamsize,1,a.channels),e=function(b){var c,d,e,f,g;a.process(),c=a.L,d=a.R,e=b.outputBuffer.getChannelData(0),f=b.outputBuffer.getChannelData(1);for(g=e.length;g--;)e[g]=c[g],f[g]=d[g]};return{on:function(){this.node=c.createJavaScriptNode(a.streamsize,1,a.channels),this.node.onaudioprocess=e,this.node.connect(c.destination)},off:function(){this.node.disconnect(),this.node=null}}},e=function(a){var d=this,e,f,g,h,i;e=new Audio,e.mozSetup(a.channels,b.samplerate),b.samplerate=e.mozSampleRate,b.channels=e.mozChannels,f=new c,g=a.streamsize/b.samplerate*1e3,h=new Float32Array(a.streamsize*a.channels),i=function(){var b,c,d,f;e.mozWriteAudio(h),a.process(),b=a.L,c=a.R,d=h.length,f=b.length;while(f--)h[--d]=c[f],h[--d]=b[f]};return{on:function(){f.setInterval(i,g)},off:function(){f.clearInterval();for(var a=h.length;a--;)h[a]=0}}};typeof webkitAudioContext=="function"?(b.env="webkit",b.sys.bind(d)):typeof Audio=="function"&&typeof (new Audio).mozSetup=="function"&&(b.env="moz",b.sys.bind(e)),b.utils.relpath2rootpath=function(b){if(/^https?:\/\//.test(b))return b;if(b[0]==="/")return b;var c=a.location.pathname;c=c.substr(0,c.lastIndexOf("/")),c=c.split("/").filter(function(a){return a!==""}),b=b.split("/");for(var d=0;d<b.length;++d)b[d]===".."?c.pop():b[d]!=="."&&c.push(b[d]);return"/"+c.join("/")},b.platform="web",b.context=a,function(){var a=[];a.push("timbre "+b.VERSION),a.push(" (build: "+b.BUILD+")"),b.env==="webkit"?a.push(" on WebAudioAPI"):b.env==="moz"&&a.push(" on AudioDataAPI"),console.log(a.join(""))}(),a.T=b}(a,b),typeof importScripts=="function"&&function(a,b){a.actions={},a.actions["wav.decode"]=function(c){var d;d=c.src,/\.wav$/.test(d)&&b.utils.binary.load(d,function(c){b.utils.wav.decode(c,function(b){var c,d,e;if(b.err)a.postMessage({result:undefined,err:b.err});else{c=b.buffer,a.postMessage({result:"metadata",samplerate:b.samplerate,bufferSize:c.length}),d=0;do e=c.subarray(d,d+8192),a.postMessage({result:"data",array:e,offset:d}),d+=e.length;while(e.length);a.postMessage({result:"ended"})}})})},a.onmessage=function(b){var c=a.actions[b.data.action];c!==undefined&&c(b.data)},b.platform="web",b.context=a}(a,b),typeof process=="object"&&process.title==="node"&&function(a,b){b.platform="node",b.context=global,module.exports=b}(a,b),b.isEnabled=!!b.sys._.impl,Object.freeze(b);return b}(this)